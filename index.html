<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>RMUTTO - VASD ‚Äì Veterinary Academic Service Division</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Tahoma, sans-serif;
  background: #f4f6f8;
  color: #333;
}
header {
  background: #ffffff;
  border-bottom: 1px solid #e0e0e0;
  padding: 12px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 {
  margin: 0;
  font-size: 22px;
  color: #2c7be5;
}
header span {
  font-size: 14px;
  color: #666;
}

/* ===== USER PANEL ===== */
.user-panel {
  display: flex;
  gap: 6px;
  align-items: center;
}
.user-panel input,
.user-panel select {
  padding: 4px 6px;
  font-size: 13px;
}
.user-panel button {
  padding: 4px 10px;
  font-size: 13px;
  font-weight: bold;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.btn-ok { background:#2c7be5; color:#fff; }
.btn-logout { background:#6c757d; color:#fff; }

/* ===== MAIN ===== */
.container {
  max-width: 1100px;
  margin: auto;
  padding: 24px;
}
.notice {
  background: #ffffff;
  border: 1px dashed #2c7be5;
  padding: 18px;
  border-radius: 10px;
  margin-bottom: 24px;
  text-align: center;
  color: #2c7be5;
  font-weight: bold;
}
.summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 16px;
  margin-bottom: 30px;
}
.summary-card {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.summary-card h2 {
  margin: 0;
  font-size: 28px;
  color: #2c7be5;
}
.menu {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}
.card {
  background: #ffffff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  cursor: pointer;
}
.card h3 {
  margin-top: 0;
  color: #2c7be5;
}
footer {
  text-align: center;
  font-size: 13px;
  color: #999;
  margin: 40px 0 10px;
}
</style>
</head>

<body>

<header>
  <div>
    <h1>RMUTTO - VASD</h1>
    <span>RMUTTO - Veterinary Academic Service Division</span>
  </div>

  <!-- USER LOGIN -->
  <div class="user-panel" id="loginPanel">
    <input id="userName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
    <select id="userRole">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
      <option value="admin">admin</option>
      <option value="‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
      <option value="‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå">‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
      <option value="‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ">‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ</option>
      <option value="‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏®‡∏±‡∏•‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå">‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏®‡∏±‡∏•‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
      <option value="‡∏ô‡∏® ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•">‡∏ô‡∏® ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
      <option value="‡∏ô‡∏® ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î">‡∏ô‡∏® ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</option>
      <option value="‡∏ô‡∏® ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ô‡∏® ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
    </select>
    <input id="adminPwd" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™ admin"
           style="display:none;width:80px">
    <button class="btn-ok" onclick="login()">OK</button>
  </div>

  <!-- USER INFO -->
  <div class="user-panel" id="userInfo" style="display:none">
    üë§ <span id="showUser"></span>
    <button class="btn-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å</button>
  </div>
</header>

<div class="container">

  <div class="notice">
    ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (Registration ‚Äì PC) ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  </div>

  <div class="summary">
    <div class="summary-card"><h2 id="totalAnimal">‚Äì</h2><p>‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p></div>
    <div class="summary-card"><h2 id="inSurgery">‚Äì</h2><p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</p></div>
    <div class="summary-card"><h2 id="recovery">‚Äì</h2><p>‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</p></div>
    <div class="summary-card"><h2 id="done">‚Äì</h2><p>‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p></div>
  </div>

  <div class="menu">
    <div class="card" onclick="location.href='registration.html'">
      <h3>üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
    </div>
    <div class="card" onclick="location.href='animals.html'">
      <h3>üêæ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
    </div>
    <div class="card"><h3>üìã ‡∏Ñ‡∏¥‡∏ß‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</h3></div>
    <div class="card"><h3>üíâ ‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ</h3></div>
    <div class="card"><h3>üü£ ‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</h3></div>
    <div class="card"><h3>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3></div>
    <div class="card"><h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3></div>
  </div>

</div>

<footer>
  RMUTTO - VASD ¬© 2026 ‚Äì RMUTTO - Veterinary Academic Service Division
</footer>

<script type="module">
import { supabase } from "./js/supabase.js";

/* ===== LOGIN ===== */
const nameInput = document.getElementById("userName");
const roleSelect = document.getElementById("userRole");
const pwdInput  = document.getElementById("adminPwd");
const loginPanel = document.getElementById("loginPanel");
const userInfo = document.getElementById("userInfo");
const showUser = document.getElementById("showUser");

roleSelect.onchange = () => {
  pwdInput.style.display = roleSelect.value === "admin" ? "inline-block" : "none";
};

window.login = function () {
  const name = nameInput.value.trim();
  const role = roleSelect.value;

  if (!name || !role) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà");
    return;
  }

  if (role === "admin" && pwdInput.value !== "2500") {
    alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô admin ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return;
  }

  localStorage.setItem("vasd_user", name);
  localStorage.setItem("vasd_role", role);
  showUser.innerText = `${name} (${role})`;
  loginPanel.style.display = "none";
  userInfo.style.display = "flex";
};

window.logout = function () {
  localStorage.clear();
  location.reload();
};

/* ===== LOAD SESSION ===== */
const savedName = localStorage.getItem("vasd_user");
const savedRole = localStorage.getItem("vasd_role");
if (savedName && savedRole) {
  showUser.innerText = `${savedName} (${savedRole})`;
  loginPanel.style.display = "none";
  userInfo.style.display = "flex";
}

/* ===== DASHBOARD ===== */
async function loadSummary() {
  const { data: eventId } = await supabase.rpc("get_today_event");

  const total = (await supabase.from("vasd_animal")
    .select("*", { count:"exact", head:true }).eq("event_id", eventId)).count;

  const surgery = (await supabase.from("vasd_queue")
    .select("*", { count:"exact", head:true }).eq("status","surgery")).count;

  const recovery = (await supabase.from("vasd_queue")
    .select("*", { count:"exact", head:true }).eq("status","recovery")).count;

  const done = (await supabase.from("vasd_queue")
    .select("*", { count:"exact", head:true }).eq("status","done")).count;

  totalAnimal.innerText = total ?? 0;
  inSurgery.innerText = surgery ?? 0;
  recovery.innerText = recovery ?? 0;
  done.innerText = done ?? 0;
}

loadSummary();
</script>

</body>
</html>
