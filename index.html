<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>RMUTTO - VASD ‚Äì Veterinary Academic Service Division</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=IBM+Plex+Sans+Thai:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
  :root {
    --navy: #0d1b2a;
    --teal: #1a6b72;
    --teal-light: #22919a;
    --accent: #00d4aa;
    --accent2: #f0a500;
    --bg: #f0f4f8;
    --surface: #ffffff;
    --text: #1a202c;
    --text-muted: #718096;
    --border: #e2e8f0;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 16px rgba(13,27,42,0.08);
    --radius: 14px;
    --radius-sm: 8px;
    
    /* Colors for status */
    --c-total: #718096;
    --c-waiting: #d69e2e;
    --c-surgery: #e53e3e;
    --c-recovery: #805ad5;
    --c-ready: #3182ce;
    --c-done: #38a169;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: "Sarabun", sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
  header {
    background: var(--navy);
    padding: 0 32px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 68px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 20px rgba(0,0,0,0.25);
  }

  .header-brand { display: flex; align-items: center; gap: 14px; }
  .brand-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--teal-light), var(--accent));
    border-radius: 10px; display: flex; align-items: center; justify-content: center;
    font-size: 20px; flex-shrink: 0;
  }
  .brand-text h1 { font-size: 17px; font-weight: 700; color: #ffffff; line-height: 1.2; }
  .brand-text span { font-size: 11px; color: rgba(255,255,255,0.5); }

  /* ‚îÄ‚îÄ‚îÄ USER PANEL ‚îÄ‚îÄ‚îÄ */
  .user-panel { display: flex; gap: 8px; align-items: center; }
  .user-panel input, .user-panel select {
    padding: 8px 12px; font-size: 13px; font-family: "Sarabun", sans-serif;
    background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
    border-radius: var(--radius-sm); color: #fff; outline: none;
  }
  .user-panel input::placeholder { color: rgba(255,255,255,0.4); }
  .user-panel input:focus, .user-panel select:focus { border-color: var(--accent); background: rgba(255,255,255,0.12); }
  .user-panel select option { background: var(--navy); color: #fff; }

  .btn-ok {
    padding: 8px 18px; font-size: 13px; font-weight: 600; font-family: "Sarabun", sans-serif;
    background: linear-gradient(135deg, var(--teal-light), var(--accent));
    color: #fff; border: none; border-radius: var(--radius-sm); cursor: pointer; white-space: nowrap;
  }
  .btn-logout {
    padding: 7px 14px; font-size: 13px; font-weight: 500; font-family: "Sarabun", sans-serif;
    background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8);
    border: 1px solid rgba(255,255,255,0.2); border-radius: var(--radius-sm); cursor: pointer;
  }
  
  .user-badge { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 30px; padding: 5px 14px 5px 8px; }
  .user-avatar { width: 28px; height: 28px; background: linear-gradient(135deg, var(--teal-light), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; }
  #showUser { font-size: 13px; color: rgba(255,255,255,0.9); font-weight: 500; }

  /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
  .container { max-width: 1100px; margin: 0 auto; padding: 32px 24px; flex: 1; }

  .date-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; animation: fadeUp 0.4s ease both; }
  .date-bar h2 { font-size: 20px; font-weight: 700; color: var(--navy); }
  .date-chip { font-size: 13px; color: var(--text-muted); background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 5px 14px; }

  /* ‚îÄ‚îÄ‚îÄ COMPACT SUMMARY CARDS (HYBRID) ‚îÄ‚îÄ‚îÄ */
  .summary {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 32px;
  }
  @media (max-width: 768px) {
    .summary { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) {
    .summary { grid-template-columns: 1fr; }
  }

  .summary-card {
    background: var(--surface);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 14px;
    position: relative;
    overflow: hidden;
    animation: fadeUp 0.4s ease both;
  }
  .summary-card::before {
    content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  }

  .summary-card:nth-child(1)::before { background: var(--c-total); }
  .summary-card:nth-child(2)::before { background: var(--c-waiting); }
  .summary-card:nth-child(3)::before { background: var(--c-surgery); }
  .summary-card:nth-child(4)::before { background: var(--c-recovery); }
  .summary-card:nth-child(5)::before { background: var(--c-ready); }
  .summary-card:nth-child(6)::before { background: var(--c-done); }

  .summary-card:nth-child(1) { animation-delay: 0.05s; }
  .summary-card:nth-child(2) { animation-delay: 0.1s; }
  .summary-card:nth-child(3) { animation-delay: 0.15s; }
  .summary-card:nth-child(4) { animation-delay: 0.2s; }
  .summary-card:nth-child(5) { animation-delay: 0.25s; }
  .summary-card:nth-child(6) { animation-delay: 0.3s; }

  .card-icon-sm { font-size: 24px; line-height: 1; }
  .summary-info { display: flex; flex-direction: column; }
  .summary-info h2 { font-size: 20px; font-weight: 700; color: var(--navy); line-height: 1; margin-bottom: 2px; }
  .summary-info p { font-size: 12px; color: var(--text-muted); font-weight: 500; }

  /* ‚îÄ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ‚îÄ */
  .section-label { font-size: 12px; font-weight: 700; letter-spacing: 1.2px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 14px; animation: fadeUp 0.4s 0.2s ease both; }

  /* ‚îÄ‚îÄ‚îÄ MENU CARDS ‚îÄ‚îÄ‚îÄ */
  .menu { display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 16px; }

  .card {
    background: var(--surface); border-radius: var(--radius); padding: 24px 22px;
    box-shadow: var(--shadow-sm); border: 1px solid var(--border); cursor: pointer;
    transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
    animation: fadeUp 0.4s ease both; position: relative; overflow: hidden; text-decoration: none; display: block;
  }
  .card:hover { box-shadow: var(--shadow-md); transform: translateY(-3px); border-color: var(--teal-light); }
  .card:hover .card-arrow { opacity: 1; transform: translateX(0); }

  .card-emoji { font-size: 26px; display: block; margin-bottom: 12px; line-height: 1; }
  .card h3 { font-size: 15px; font-weight: 600; color: var(--navy); margin-bottom: 4px; }
  .card p { font-size: 12px; color: var(--text-muted); line-height: 1.5; margin-top: 4px; padding-right: 10px;}

  .card-arrow {
    position: absolute; bottom: 18px; right: 18px; width: 24px; height: 24px;
    background: var(--teal-light); border-radius: 50%; display: flex; align-items: center; justify-content: center;
    color: #fff; font-size: 12px; opacity: 0; transform: translateX(4px); transition: opacity 0.2s, transform 0.2s;
  }

  /* ‚îÄ‚îÄ‚îÄ NOTIFICATION BADGE ‚îÄ‚îÄ‚îÄ */
  .menu-badge {
    position: absolute;
    top: 16px;
    right: 16px;
    background: var(--c-surgery);
    color: white;
    font-size: 12px;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 20px;
    box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.4);
    animation: pulse 2s infinite;
    display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
    z-index: 10;
  }
  
  /* ‡πÅ‡∏¢‡∏Å‡∏™‡∏µ Badge ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
  .badge-waiting { background: var(--c-waiting); box-shadow: 0 0 0 0 rgba(214, 158, 46, 0.4); }
  .badge-surgery { background: var(--c-surgery); box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.4); }
  .badge-recovery { background: var(--c-recovery); box-shadow: 0 0 0 0 rgba(128, 90, 213, 0.4); }
  .badge-ready { background: var(--c-ready); box-shadow: 0 0 0 0 rgba(49, 130, 206, 0.4); }

  @keyframes pulse {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 currentColor; }
    70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(0,0,0,0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
  }

  footer { text-align: center; font-size: 12px; color: var(--text-muted); padding: 20px; border-top: 1px solid var(--border); background: var(--surface); }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>

<body>

<header>
  <div class="header-brand">
    <div class="brand-icon">üêæ</div>
    <div class="brand-text">
      <h1>RMUTTO ‚Äì VASD</h1>
      <span>Veterinary Academic Service Division</span>
    </div>
  </div>

  <div class="user-panel" id="loginPanel">
    <input id="userName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" style="width:120px">
    <select id="userRole">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
      <option value="admin">admin</option>
      <option value="‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
      <option value="‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå">‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
      <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
      <option value="‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ">‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ</option>
      <option value="‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏®‡∏±‡∏•‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå">‡∏ô‡∏® ‡∏õ‡∏µ 4 ‡∏®‡∏±‡∏•‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
      <option value="‡∏ô‡∏® ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•">‡∏ô‡∏® ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
      <option value="‡∏ô‡∏® ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î">‡∏ô‡∏® ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</option>
      <option value="‡∏ô‡∏® ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ô‡∏® ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
    </select>
    <input id="adminPwd" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™ admin" style="display:none;width:90px">
    <button class="btn-ok" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <div class="user-panel" id="userInfo" style="display:none">
    <div class="user-badge"><div class="user-avatar">üë§</div><span id="showUser"></span></div>
    <button class="btn-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>
</header>

<div class="container">

  <div class="date-bar">
    <h2>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
    <div class="date-chip" id="todayDate">‚Äì</div>
  </div>

  <div class="summary">
    <div class="summary-card">
      <span class="card-icon-sm">üêæ</span>
      <div class="summary-info"><h2 id="totalAnimal">‚Äì</h2><p>‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>
    </div>
    <div class="summary-card">
      <span class="card-icon-sm">‚è≥</span>
      <div class="summary-info"><h2 id="waiting">‚Äì</h2><p>‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</p></div>
    </div>
    <div class="summary-card">
      <span class="card-icon-sm">üî¨</span>
      <div class="summary-info"><h2 id="inSurgery">‚Äì</h2><p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</p></div>
    </div>
    <div class="summary-card">
      <span class="card-icon-sm">üõèÔ∏è</span>
      <div class="summary-info"><h2 id="recovery">‚Äì</h2><p>‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</p></div>
    </div>
    <div class="summary-card">
      <span class="card-icon-sm">üïí</span>
      <div class="summary-info"><h2 id="ready">‚Äì</h2><p>‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏¢‡∏≤/‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö</p></div>
    </div>
    <div class="summary-card">
      <span class="card-icon-sm">‚úÖ</span>
      <div class="summary-info"><h2 id="done">‚Äì</h2><p>‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p></div>
    </div>
  </div>

  <div class="section-label">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏™‡∏Ñ‡πâ‡∏≤‡∏á)</div>
  <div class="menu">

    <div class="card" onclick="location.href='registration.html'">
      <span class="card-emoji">üìù</span>
      <h3>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3><p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='animals.html'">
      <span class="card-emoji">üêæ</span>
      <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='surgery.html'">
      <div class="menu-badge badge-waiting" id="badge-surgery-menu">0 ‡πÄ‡∏Ñ‡∏™‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß</div> <span class="card-emoji">üìã</span>
      <h3>‡πÇ‡∏ï‡πä‡∏∞‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</h3><p>‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='anesthesia.html'">
      <div class="menu-badge badge-surgery" id="badge-anes-menu">0 ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤</div> <span class="card-emoji">ü©∫</span>
      <h3>‡∏ß‡∏≤‡∏á‡∏¢‡∏≤‡∏™‡∏•‡∏ö</h3><p>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≤ / ‡∏ß‡∏≤‡∏á‡∏¢‡∏≤ / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Vitals</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='recovery.html'">
      <div class="menu-badge badge-recovery" id="badge-recovery-menu">0 ‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</div> <span class="card-emoji">üü£</span>
      <h3>‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</h3><p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='rx.html'">
      <div class="menu-badge badge-ready" id="badge-rx-menu">0 ‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏¢‡∏≤</div> <span class="card-emoji">üíä</span>
      <h3>‡πÇ‡∏ï‡πä‡∏∞‡∏à‡∏±‡∏î‡∏¢‡∏≤</h3><p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏¢‡∏≤</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='report.html'">
      <span class="card-emoji">üìä</span>
      <h3>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3><p>‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

    <div class="card" onclick="location.href='settings.html'">
      <span class="card-emoji">‚öôÔ∏è</span>
      <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3><p>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</p>
      <div class="card-arrow">‚Ä∫</div>
    </div>

  </div>
</div>

<footer>RMUTTO ‚Äì VASD ¬© 2026 &nbsp;¬∑&nbsp; Veterinary Academic Service Division</footer>

<script type="module">
import { supabase } from "./js/supabase.js";

/* ‚îÄ‚îÄ Date ‚îÄ‚îÄ */
const dateEl = document.getElementById("todayDate");
const now = new Date();
dateEl.textContent = now.toLocaleDateString("th-TH", { weekday: "long", year: "numeric", month: "long", day: "numeric" });

/* ‚îÄ‚îÄ Login ‚îÄ‚îÄ */
const nameInput  = document.getElementById("userName");
const roleSelect = document.getElementById("userRole");
const pwdInput   = document.getElementById("adminPwd");
const loginPanel = document.getElementById("loginPanel");
const userInfo   = document.getElementById("userInfo");
const showUser   = document.getElementById("showUser");

roleSelect.onchange = () => { pwdInput.style.display = roleSelect.value === "admin" ? "inline-block" : "none"; };

window.login = function () {
  const name = nameInput.value.trim();
  const role = roleSelect.value;
  if (!name || !role) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà"); return; }
  if (role === "admin" && pwdInput.value !== "2500") { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô admin ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); return; }
  localStorage.setItem("vasd_user", name); localStorage.setItem("vasd_role", role);
  showUser.innerText = `${name} (${role})`; loginPanel.style.display = "none"; userInfo.style.display = "flex";
};

window.logout = function () { localStorage.clear(); location.reload(); };

/* ‚îÄ‚îÄ Restore Session ‚îÄ‚îÄ */
const savedName = localStorage.getItem("vasd_user");
const savedRole = localStorage.getItem("vasd_role");
if (savedName && savedRole) {
  showUser.innerText = `${savedName} (${savedRole})`; loginPanel.style.display = "none"; userInfo.style.display = "flex";
}

/* ‚îÄ‚îÄ Dashboard Summary & Badges ‚îÄ‚îÄ */
async function loadSummary() {
  const { data: eventId } = await supabase.rpc("get_today_event");

  const total    = (await supabase.from("vasd_animal").select("*",{count:"exact",head:true}).eq("event_id",eventId)).count || 0;
  const waiting  = (await supabase.from("vasd_queue").select("*",{count:"exact",head:true}).eq("status","waiting")).count || 0;
  const surgery  = (await supabase.from("vasd_queue").select("*",{count:"exact",head:true}).eq("status","surgery")).count || 0;
  const recovery = (await supabase.from("vasd_queue").select("*",{count:"exact",head:true}).eq("status","recovery")).count || 0;
  const ready    = (await supabase.from("vasd_queue").select("*",{count:"exact",head:true}).eq("status","ready_to_go_home")).count || 0;
  const done     = (await supabase.from("vasd_queue").select("*",{count:"exact",head:true}).eq("status","done")).count || 0;

  // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô Compact Summary
  document.getElementById("totalAnimal").innerText = total;
  document.getElementById("waiting").innerText     = waiting;
  document.getElementById("inSurgery").innerText   = surgery;
  document.getElementById("recovery").innerText    = recovery;
  document.getElementById("ready").innerText       = ready;
  document.getElementById("done").innerText        = done;

  // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Notification Badges ‡∏ö‡∏ô‡πÄ‡∏°‡∏ô‡∏π (‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ > 0 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
  const bSurgery = document.getElementById("badge-surgery-menu");
  bSurgery.innerText = `${waiting} ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß`;
  bSurgery.style.display = waiting > 0 ? "block" : "none";

  const bAnes = document.getElementById("badge-anes-menu");
  bAnes.innerText = `${surgery} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤`;
  bAnes.style.display = surgery > 0 ? "block" : "none";

  const bRecovery = document.getElementById("badge-recovery-menu");
  bRecovery.innerText = `${recovery} ‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô`;
  bRecovery.style.display = recovery > 0 ? "block" : "none";

  const bRx = document.getElementById("badge-rx-menu");
  bRx.innerText = `${ready} ‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏¢‡∏≤`;
  bRx.style.display = ready > 0 ? "block" : "none";
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
loadSummary();

// Real-time Dashboard Update (‡∏ñ‡πâ‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏•‡∏Ç‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå)
supabase.channel('dashboard-live')
  .on('postgres_changes', { event: '*', schema: 'public', table: 'vasd_queue' }, loadSummary)
  .on('postgres_changes', { event: '*', schema: 'public', table: 'vasd_animal' }, loadSummary)
  .subscribe();

</script>
</body>
</html>
