<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¢à¸´à¸™à¸¢à¸­à¸¡à¸à¸²à¸£à¸£à¸±à¸à¸©à¸² â€“ VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS (Match with Main App)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.3);
  --emerald:    #10b981;
  --amber:      #f59e0b;
  --rose:       #ef4444;

  --surface:    rgba(255,255,255,0.05);
  --surface-2:  rgba(255,255,255,0.08);
  --border:     rgba(255,255,255,0.1);
  --text:       #f8fafc;
  --text-dim:   #94a3b8;
  --text-faint: #64748b;

  --radius-lg:  24px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Sarabun", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  overflow-x: hidden;
}
body::before {
  content: ""; position: fixed; inset: 0; z-index: -1;
  background: radial-gradient(circle at 50% 0%, rgba(14,165,160,0.15) 0%, transparent 60%);
}

.container {
  width: 100%; max-width: 800px;
  padding: 20px;
}

/* â”€â”€ STATES â”€â”€ */
#standbyScreen, #successScreen {
  text-align: center; padding: 60px 20px;
  animation: fadeIn 0.5s ease;
}
#consentScreen {
  display: none; /* à¸‹à¹ˆà¸­à¸™à¹„à¸§à¹‰à¸£à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸² */
  animation: slideUp 0.5s ease;
}

/* â”€â”€ CARDS â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.card-title {
  font-size: 22px; font-weight: 700; color: var(--teal-light);
  margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
  border-bottom: 1px solid var(--border); padding-bottom: 12px;
}

/* â”€â”€ OWNER INFO â”€â”€ */
.info-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
}
.info-item { display: flex; flex-direction: column; gap: 4px; }
.info-label { font-size: 14px; color: var(--text-dim); text-transform: uppercase; font-weight: 600; letter-spacing: 1px;}
.info-value { font-size: 20px; font-weight: 600; color: #fff; }

/* â”€â”€ ANIMALS LIST â”€â”€ */
.animal-item {
  background: var(--surface-2); border-radius: 12px;
  padding: 16px; margin-bottom: 12px;
  display: flex; justify-content: space-between; align-items: center;
}
.animal-name { font-size: 20px; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 10px;}
.animal-spc { font-size: 14px; color: var(--text-dim); background: var(--surface); padding: 4px 10px; border-radius: 20px;}
.animal-svcs { font-size: 16px; color: var(--amber); font-weight: 600; text-align: right;}

/* â”€â”€ CONSENT TEXT â”€â”€ */
.consent-box {
  background: rgba(245, 158, 11, 0.05);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
}
.consent-box h3 { color: var(--amber); font-size: 24px; margin-bottom: 16px; text-align: center;}
.consent-box p { font-size: 18px; line-height: 1.6; color: var(--text); margin-bottom: 16px; }
.consent-box p:last-child { margin-bottom: 0; }

/* â”€â”€ BUTTON â”€â”€ */
.btn-accept {
  width: 100%;
  background: linear-gradient(135deg, var(--emerald), #34d399);
  color: #fff; font-size: 28px; font-weight: 700; font-family: "Sarabun", sans-serif;
  padding: 20px; border: none; border-radius: var(--radius-lg);
  cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px;
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
  transition: transform 0.2s, filter 0.2s;
}
.btn-accept:active { transform: scale(0.98); }

/* à¹„à¸­à¸„à¸­à¸™à¸«à¸¡à¸¸à¸™à¸£à¸­ */
.spinner {
  width: 60px; height: 60px;
  border: 5px solid var(--surface-2); border-top-color: var(--teal);
  border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;
}

@keyframes spin { to { transform: rotate(360deg); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="container">

  <div id="standbyScreen">
    <div class="spinner"></div>
    <h2 style="font-size: 28px; color: var(--text);">à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ...</h2>
    <p style="font-size: 18px; color: var(--text-dim); margin-top: 10px;">à¸à¸³à¸¥à¸±à¸‡à¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¢à¸´à¸™à¸¢à¸­à¸¡</p>
  </div>

  <div id="consentScreen">
    
    <div class="card">
      <div class="card-title">ğŸ‘¤ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸ªà¸±à¸•à¸§à¹Œ</div>
      <div class="info-grid">
        <div class="info-item"><span class="info-label">à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥</span><span class="info-value" id="dispName">-</span></div>
        <div class="info-item"><span class="info-label">à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ</span><span class="info-value" id="dispPhone">-</span></div>
        <div class="info-item"><span class="info-label">à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™</span><span class="info-value" id="dispId">-</span></div>
        <div class="info-item"><span class="info-label">à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ</span><span class="info-value" id="dispAddress" style="font-size: 16px;">-</span></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ¾ à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œà¹à¸¥à¸°à¸šà¸£à¸´à¸à¸²à¸£ (<span id="dispCount">0</span> à¸•à¸±à¸§)</div>
      <div id="dispAnimals">
        </div>
    </div>

    <div class="consent-box">
      <h3>âš–ï¸ à¸‚à¹‰à¸­à¸•à¸à¸¥à¸‡à¹à¸¥à¸°à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¢à¸´à¸™à¸¢à¸­à¸¡</h3>
      <p><strong>1. à¸à¸²à¸£à¸‡à¸”à¸™à¹‰à¸³à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£:</strong> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸¢à¸·à¸™à¸¢à¸±à¸™à¸§à¹ˆà¸²à¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸‡à¸”à¸™à¹‰à¸³à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£à¸¡à¸²à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² 8-12 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ à¹€à¸à¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸­à¸±à¸™à¸•à¸£à¸²à¸¢à¸–à¸¶à¸‡à¸Šà¸µà¸§à¸´à¸•à¸ˆà¸²à¸à¸à¸²à¸£à¸ªà¸³à¸¥à¸±à¸à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸§à¸²à¸‡à¸¢à¸²à¸ªà¸¥à¸š</p>
      <p><strong>2. à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ˆà¸²à¸à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²:</strong> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¸§à¹ˆà¸²à¸à¸²à¸£à¸§à¸²à¸‡à¸¢à¸²à¸ªà¸¥à¸šà¹à¸¥à¸°à¸à¸²à¸£à¸—à¸³à¸¨à¸±à¸¥à¸¢à¸à¸£à¸£à¸¡à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡ à¹à¸¡à¹‰à¸ªà¸±à¸•à¸§à¹à¸à¸—à¸¢à¹Œà¸ˆà¸°à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸­à¸¢à¹ˆà¸²à¸‡à¸£à¸°à¸¡à¸±à¸”à¸£à¸°à¸§à¸±à¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹à¸¥à¹‰à¸§à¸à¹‡à¸•à¸²à¸¡</p>
      <p><strong>3. à¸à¸²à¸£à¸¢à¸´à¸™à¸¢à¸­à¸¡:</strong> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸¢à¸´à¸™à¸¢à¸­à¸¡à¹ƒà¸«à¹‰à¸ªà¸±à¸•à¸§à¹à¸à¸—à¸¢à¹Œà¸—à¸³à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¹à¸¥à¸°à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¸Šà¸µà¸§à¸´à¸•à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡ à¸«à¸²à¸à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™</p>
    </div>

    <button type="button" class="btn-accept" onclick="acceptConsent()">
      âœ… à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸¢à¸­à¸¡à¸£à¸±à¸šà¸‚à¹‰à¸­à¸•à¸à¸¥à¸‡à¹à¸¥à¸°à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚
    </button>
  </div>

  <div id="successScreen" style="display:none;">
    <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
    <h2 style="font-size: 32px; color: var(--emerald);">à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¹ˆà¸°/à¸„à¸£à¸±à¸š</h2>
    <p style="font-size: 20px; color: var(--text-dim); margin-top: 10px;">à¸à¸£à¸¸à¸“à¸²à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¹€à¸à¸·à¹ˆà¸­à¸—à¸³à¸à¸²à¸£à¸à¸´à¸¡à¸à¹Œà¸„à¸´à¸§</p>
  </div>

</div>

<script type="module">
import { supabase } from "./js/supabase.js";

// à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸«à¹‰à¸­à¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¸à¸±à¸š registration.html
const consentChannel = supabase.channel('vasd-consent-room');

// à¸Ÿà¸±à¸‡à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸£à¸µà¸¢à¸à¸ˆà¸²à¸ Registration
consentChannel
  .on('broadcast', { event: 'request-consent' }, (payload) => {
    console.log("ğŸ“¥ à¹„à¸”à¹‰à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸³à¸‚à¸­:", payload);
    const data = payload.payload; // à¸”à¸¶à¸‡à¸à¹‰à¸­à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸­à¸à¸¡à¸²
    showConsentForm(data);
  })
  .subscribe();

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸³à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸²à¹à¸ªà¸”à¸‡à¸šà¸™à¸«à¸™à¹‰à¸²à¸ˆà¸­
function showConsentForm(data) {
  // à¸‹à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¸ˆà¸­ Standby
  document.getElementById("standbyScreen").style.display = "none";
  document.getElementById("successScreen").style.display = "none";
  
  // à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
  document.getElementById("dispName").textContent = data.owner.name;
  document.getElementById("dispPhone").textContent = data.owner.phone;
  document.getElementById("dispId").textContent = data.owner.idCard;
  document.getElementById("dispAddress").textContent = data.owner.address;
  document.getElementById("dispCount").textContent = data.animals.length;

  // à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œ
  const container = document.getElementById("dispAnimals");
  container.innerHTML = "";
  data.animals.forEach(anim => {
    const icon = anim.species === "à¹à¸¡à¸§" ? "ğŸ±" : "ğŸ¶";
    const svcs = anim.services.join(", ");
    container.innerHTML += `
      <div class="animal-item">
        <div class="animal-name">${icon} ${anim.name} <span class="animal-spc">${anim.sex}</span></div>
        <div class="animal-svcs">${svcs}</div>
      </div>
    `;
  });

  // à¹‚à¸Šà¸§à¹Œà¸«à¸™à¹‰à¸² Consent
  document.getElementById("consentScreen").style.display = "block";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

// à¹€à¸¡à¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¸¢à¸­à¸¡à¸£à¸±à¸šà¸‚à¹‰à¸­à¸•à¸à¸¥à¸‡"
window.acceptConsent = function() {
  // à¸ªà¹ˆà¸‡à¸ªà¸±à¸à¸à¸²à¸“à¸à¸¥à¸±à¸šà¹„à¸›à¸—à¸µà¹ˆ Registration à¸§à¹ˆà¸²à¸¢à¸­à¸¡à¸£à¸±à¸šà¹à¸¥à¹‰à¸§
  consentChannel.send({
    type: 'broadcast',
    event: 'consent-granted',
    payload: { status: 'accepted', timestamp: new Date().toISOString() }
  });

  // à¸‹à¹ˆà¸­à¸™à¸Ÿà¸­à¸£à¹Œà¸¡ à¹‚à¸Šà¸§à¹Œà¸«à¸™à¹‰à¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
  document.getElementById("consentScreen").style.display = "none";
  document.getElementById("successScreen").style.display = "block";

  // à¸«à¸™à¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² 5 à¸§à¸´à¸™à¸²à¸—à¸µ à¹à¸¥à¹‰à¸§à¸£à¸µà¹€à¸‹à¹‡à¸•à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸²à¸ªà¹à¸•à¸™à¸”à¹Œà¸šà¸²à¸¢
  setTimeout(() => {
    document.getElementById("successScreen").style.display = "none";
    document.getElementById("standbyScreen").style.display = "block";
  }, 5000);
}
</script>
</body>
</html>
