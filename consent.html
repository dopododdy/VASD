<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¢à¸´à¸™à¸¢à¸­à¸¡à¸à¸²à¸£à¸£à¸±à¸à¸©à¸² â€“ VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&family=Sarabun:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS (iPad Landscape - No Scroll)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --teal:       #0ea5a0;
  --teal-light: #2dd4bf;
  --emerald:    #10b981;
  --amber:      #fbbf24;
  --rose:       #f87171;

  --surface:    rgba(255,255,255,0.06);
  --surface-2:  rgba(255,255,255,0.1);
  --border:     rgba(255,255,255,0.15);
  --text:       #ffffff;
  --text-dim:   #cbd5e1;

  --radius-lg:  20px;
  --radius-xl:  32px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Sarabun", sans-serif;
  background: var(--navy);
  color: var(--text);
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  display: flex; 
  align-items: center; 
  justify-content: center;
  touch-action: none;
}
body::before {
  content: ""; position: absolute; inset: 0; z-index: -1;
  background: radial-gradient(circle at 50% 0%, rgba(14,165,160,0.15) 0%, transparent 60%);
}

.container {
  width: 100%; height: 100%;
  max-width: 1366px;
  padding: 32px 40px;
  display: flex;
  flex-direction: column;
}

/* â”€â”€ STATES â”€â”€ */
#standbyScreen, #successScreen, #consentScreen {
  height: 100%; width: 100%;
  animation: fadeIn 0.4s ease;
}
#consentScreen { display: none; }
#successScreen { display: none; text-align: center; flex-direction: column; justify-content: center; align-items: center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STANDBY SCREEN (Single Column Centered)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#standbyScreen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 30px;
}

/* 1. Header (Logo & Name) */
.standby-header {
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.brand-logo {
  height: 100px; /* à¸¢à¹ˆà¸­à¸‚à¸™à¸²à¸”à¹‚à¸¥à¹‚à¸à¹‰à¸¥à¸‡à¹ƒà¸«à¹‰à¸à¸­à¸”à¸µà¸ˆà¸­ */
  width: auto;
  margin-bottom: 16px;
  filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3));
}
.brand-th {
  font-size: 26px;
  color: var(--teal-light);
  font-weight: 800;
  line-height: 1.4;
}
.brand-en {
  font-size: 18px;
  color: var(--text-dim);
  letter-spacing: 0.5px;
  margin-top: 4px;
}

/* 2. Warning Box */
.standby-warning {
  background: rgba(239, 68, 68, 0.05);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: var(--radius-xl);
  padding: 32px 48px;
  max-width: 900px;
  width: 100%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.warning-title {
  color: var(--amber);
  font-size: 28px;
  font-weight: 800;
  text-align: center;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}
.warning-body {
  font-size: 22px;
  line-height: 1.6;
  color: var(--text);
}
.warning-body ul {
  margin-left: 30px;
  margin-top: 10px;
  margin-bottom: 20px;
  color: var(--text-dim);
}
.warning-body li { margin-bottom: 8px; }
.warning-footer {
  border-top: 1px solid rgba(255,255,255,0.1);
  padding-top: 16px;
  color: var(--text-faint);
  font-size: 20px;
  text-align: center;
}

.highlight-rose { color: var(--rose); font-weight: 700; }
.highlight-amber { color: var(--amber); font-weight: 700; }

/* 3. Loading Area */
.standby-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 16px 32px;
  border-radius: 50px;
}
.spinner {
  width: 32px; height: 32px;
  border: 4px solid var(--surface-2); border-top-color: var(--teal-light);
  border-radius: 50%; animation: spin 1s linear infinite;
}
.standby-loading span {
  font-size: 20px;
  color: var(--text-dim);
  font-weight: 600;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSENT SCREEN (2-Column Grid)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; height: 100%; }
.col-left { display: flex; flex-direction: column; gap: 24px; }
.col-right { display: flex; flex-direction: column; gap: 24px; }

.card {
  background: var(--surface); border: 2px solid var(--border);
  border-radius: var(--radius-xl); padding: 32px;
}
.card.flex-1 { flex: 1; display: flex; flex-direction: column; min-height: 0; }

.card-title {
  font-size: 30px; font-weight: 800; color: var(--teal-light);
  margin-bottom: 20px; display: flex; align-items: center; gap: 12px;
  border-bottom: 2px solid var(--border); padding-bottom: 16px;
}

.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.info-item { display: flex; flex-direction: column; gap: 4px; }
.info-label { font-size: 20px; color: var(--text-dim); font-weight: 600; }
.info-value { font-size: 28px; font-weight: 700; color: #fff; line-height: 1.3; }

#dispAnimals { flex: 1; overflow-y: auto; padding-right: 10px; } 
#dispAnimals::-webkit-scrollbar { width: 8px; }
#dispAnimals::-webkit-scrollbar-thumb { background: var(--teal); border-radius: 10px; }

.animal-item {
  background: var(--surface-2); border-radius: 20px; border: 1px solid var(--border);
  padding: 20px 24px; margin-bottom: 16px;
  display: flex; justify-content: space-between; align-items: center;
}
.animal-name { font-size: 28px; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 12px;}
.animal-spc { font-size: 20px; color: var(--navy); background: var(--teal-light); font-weight: 700; padding: 6px 16px; border-radius: 30px;}
.animal-svcs { font-size: 26px; color: var(--amber); font-weight: 700; }

.consent-box {
  background: rgba(245, 158, 11, 0.06); border: 2px solid rgba(245, 158, 11, 0.25);
  border-radius: var(--radius-xl); padding: 40px;
  flex: 1; display: flex; flex-direction: column; justify-content: space-evenly;
}
.consent-box h3 { color: var(--amber); font-size: 34px; margin-bottom: 20px; text-align: center; font-weight: 800;}
.consent-box p { font-size: 24px; line-height: 1.7; color: var(--text); }
.consent-box strong { font-size: 26px; color: var(--amber); }

.btn-accept {
  width: 100%; height: 100px;
  background: linear-gradient(135deg, var(--emerald), #059669);
  color: #fff; font-size: 40px; font-weight: 800; font-family: "Sarabun", sans-serif;
  border: none; border-radius: 100px;
  cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 16px;
  box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
  transition: transform 0.2s, background 0.2s;
  flex-shrink: 0;
}
.btn-accept:active { transform: scale(0.97); background: #059669; }

@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="container">

  <div id="standbyScreen">
    
    <div class="standby-header">
      <img src="logo.png" alt="VASD Logo" class="brand-logo" onerror="this.style.display='none'">
      <div class="brand-th">à¸«à¸™à¹ˆà¸§à¸¢à¸šà¸£à¸´à¸à¸²à¸£à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸„à¸“à¸°à¸ªà¸±à¸•à¸§à¹à¸à¸—à¸¢à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸£à¸²à¸Šà¸¡à¸‡à¸„à¸¥à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸</div>
      <div class="brand-en">(Veterinary Academic Service Division: VASD)</div>
    </div>

    <div class="standby-warning">
      <div class="warning-title">âš ï¸ à¹‚à¸›à¸£à¸”à¸­à¹ˆà¸²à¸™ à¹à¸¥à¸°à¸—à¸³à¸„à¸§à¸²à¸¡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ</div>
      
      <div class="warning-body">
        <p>
          <span class="highlight-amber">à¸à¸²à¸£à¸§à¸²à¸‡à¸¢à¸²à¸ªà¸¥à¸šà¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡</span> 
          à¸ªà¸±à¸•à¸§à¹Œà¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸£à¸„à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§ à¹€à¸Šà¹ˆà¸™ à¸«à¸±à¸§à¹ƒà¸ˆ à¸•à¸±à¸š à¹„à¸• à¸«à¸£à¸·à¸­à¸ªà¸±à¸•à¸§à¹Œà¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸ à¸ˆà¸°à¸—à¸³à¹ƒà¸«à¹‰à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹€à¸à¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™
        </p>
        <p style="margin-top: 16px;">à¸ à¸²à¸§à¸°à¹à¸—à¸£à¸à¸‹à¹‰à¸­à¸™à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™ à¹„à¸”à¹‰à¹à¸à¹ˆ :</p>
        <ul>
          <li>à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹€à¸¥à¸·à¸­à¸”à¸•à¹ˆà¸³ / à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¸œà¸´à¸”à¸ˆà¸±à¸‡à¸«à¸§à¸°</li>
          <li>à¸ à¸²à¸§à¸°à¸«à¸²à¸¢à¹ƒà¸ˆà¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ / à¸à¸²à¸£à¹à¸à¹‰à¸¢à¸²</li>
          <li class="highlight-rose">à¸à¸²à¸£à¹€à¸ªà¸µà¸¢à¸Šà¸µà¸§à¸´à¸• (à¸à¸šà¹„à¸”à¹‰à¸™à¹‰à¸­à¸¢à¸¡à¸²à¸ à¹à¸•à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¹„à¸”à¹‰)</li>
        </ul>
      </div>

      <div class="warning-footer">
        * à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸à¸²à¸£à¸§à¸²à¸‡à¸¢à¸²à¸ªà¸¥à¸š à¸ˆà¸°à¸¡à¸µà¸à¸²à¸£à¸•à¸´à¸”à¸•à¸²à¸¡à¸ªà¸±à¸à¸à¸²à¸“à¸Šà¸µà¸à¸­à¸¢à¹ˆà¸²à¸‡à¹ƒà¸à¸¥à¹‰à¸Šà¸´à¸”
      </div>
    </div>

    <div class="standby-loading">
      <div class="spinner"></div>
      <span>à¸£à¸­à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ...</span>
    </div>

  </div>

  <div id="consentScreen" class="grid-layout">
    <div class="col-left">
      <div class="card">
        <div class="card-title">ğŸ‘¤ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸ªà¸±à¸•à¸§à¹Œ</div>
        <div class="info-grid">
          <div class="info-item"><span class="info-label">à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥</span><span class="info-value" id="dispName">-</span></div>
          <div class="info-item"><span class="info-label">à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ</span><span class="info-value" id="dispPhone">-</span></div>
          <div class="info-item"><span class="info-label">à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™</span><span class="info-value" id="dispId">-</span></div>
          <div class="info-item"><span class="info-label">à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ</span><span class="info-value" id="dispAddress" style="font-size: 22px;">-</span></div>
        </div>
      </div>
      <div class="card flex-1">
        <div class="card-title">ğŸ¾ à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œà¹à¸¥à¸°à¸šà¸£à¸´à¸à¸²à¸£ (<span id="dispCount">0</span>)</div>
        <div id="dispAnimals"></div>
      </div>
    </div>

    <div class="col-right">
      <div class="consent-box">
        <h3>âš–ï¸ à¸‚à¹‰à¸­à¸•à¸à¸¥à¸‡à¹à¸¥à¸°à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¢à¸´à¸™à¸¢à¸­à¸¡</h3>
        <p><strong>1. à¸à¸²à¸£à¸‡à¸”à¸™à¹‰à¸³à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£:</strong><br> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸¢à¸·à¸™à¸¢à¸±à¸™à¸§à¹ˆà¸²à¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸‡à¸”à¸™à¹‰à¸³à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£à¸¡à¸²à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² 8-12 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ à¹€à¸à¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸­à¸±à¸™à¸•à¸£à¸²à¸¢à¸ˆà¸²à¸à¸à¸²à¸£à¸ªà¸³à¸¥à¸±à¸</p>
        <p><strong>2. à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ˆà¸²à¸à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²:</strong><br> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¸§à¹ˆà¸²à¸à¸²à¸£à¸§à¸²à¸‡à¸¢à¸²à¸ªà¸¥à¸šà¹à¸¥à¸°à¸à¸²à¸£à¸—à¸³à¸¨à¸±à¸¥à¸¢à¸à¸£à¸£à¸¡à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡ à¹à¸¡à¹‰à¸ªà¸±à¸•à¸§à¹à¸à¸—à¸¢à¹Œà¸ˆà¸°à¸£à¸°à¸¡à¸±à¸”à¸£à¸°à¸§à¸±à¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹à¸¥à¹‰à¸§à¸à¹‡à¸•à¸²à¸¡</p>
        <p><strong>3. à¸à¸²à¸£à¸¢à¸´à¸™à¸¢à¸­à¸¡:</strong><br> à¸‚à¹‰à¸²à¸à¹€à¸ˆà¹‰à¸²à¸¢à¸´à¸™à¸¢à¸­à¸¡à¹ƒà¸«à¹‰à¸ªà¸±à¸•à¸§à¹à¸à¸—à¸¢à¹Œà¸—à¸³à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¹à¸¥à¸°à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¸Šà¸µà¸§à¸´à¸•à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡ à¸«à¸²à¸à¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™</p>
      </div>
      <button type="button" class="btn-accept" onclick="acceptConsent()">
        âœ… à¸¢à¸­à¸¡à¸£à¸±à¸šà¸‚à¹‰à¸­à¸•à¸à¸¥à¸‡à¹à¸¥à¸°à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚
      </button>
    </div>
  </div>

  <div id="successScreen">
    <div style="font-size: 120px; margin-bottom: 20px;">ğŸ‰</div>
    <h2 style="font-size: 64px; color: var(--emerald); font-weight: 800;">à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¹ˆà¸°/à¸„à¸£à¸±à¸š</h2>
    <p style="font-size: 38px; color: #fff; margin-top: 20px;">à¸à¸£à¸¸à¸“à¸²à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¸«à¸™à¹‰à¸²à¸ˆà¸­à¹ƒà¸«à¹‰à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ</p>
    <p style="font-size: 30px; color: var(--text-dim); margin-top: 10px;">à¹€à¸à¸·à¹ˆà¸­à¸—à¸³à¸à¸²à¸£à¸à¸´à¸¡à¸à¹Œà¸„à¸´à¸§à¹€à¸‚à¹‰à¸²à¸£à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£</p>
  </div>

</div>

<script type="module">
import { supabase } from "./js/supabase.js";

const consentChannel = supabase.channel('vasd-consent-room');

consentChannel
  .on('broadcast', { event: 'request-consent' }, (payload) => {
    const data = payload.payload;
    showConsentForm(data);
  })
  .subscribe();

function showConsentForm(data) {
  document.getElementById("standbyScreen").style.display = "none";
  document.getElementById("successScreen").style.display = "none";
  document.getElementById("consentScreen").style.display = "grid"; 
  
  document.getElementById("dispName").textContent = data.owner.name;
  document.getElementById("dispPhone").textContent = data.owner.phone;
  document.getElementById("dispId").textContent = data.owner.idCard;
  document.getElementById("dispAddress").textContent = data.owner.address;
  document.getElementById("dispCount").textContent = data.animals.length;

  const container = document.getElementById("dispAnimals");
  container.innerHTML = "";
  data.animals.forEach(anim => {
    const icon = anim.species === "à¹à¸¡à¸§" ? "ğŸ±" : "ğŸ¶";
    const svcs = anim.services.join(", ");
    container.innerHTML += `
      <div class="animal-item">
        <div class="animal-name">${icon} ${anim.name} <span class="animal-spc">${anim.sex}</span></div>
        <div class="animal-svcs">${svcs}</div>
      </div>
    `;
  });
}

window.acceptConsent = function() {
  consentChannel.send({
    type: 'broadcast',
    event: 'consent-granted',
    payload: { status: 'accepted', timestamp: new Date().toISOString() }
  });

  document.getElementById("consentScreen").style.display = "none";
  document.getElementById("successScreen").style.display = "flex";

  setTimeout(() => {
    document.getElementById("successScreen").style.display = "none";
    document.getElementById("standbyScreen").style.display = "flex"; // à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² Standby à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹à¸šà¸š Flex (à¸ˆà¸±à¸”à¸à¸¥à¸²à¸‡)
  }, 5000);
}
</script>
</body>
</html>
