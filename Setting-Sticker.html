<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Stickers â€“ RMUTTO VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<link href__="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&family=Kanit:wght@300;400;500;700&family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --navy-card:  #162d4a;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.25);
  --amber:      #f59e0b;
  --rose:       #ef4444;
  --violet:     #8b5cf6;
  --sky:        #3b82f6;
  --emerald:    #10b981;
  --slate:      #64748b;

  --surface:    rgba(255,255,255,0.04);
  --surface-2:  rgba(255,255,255,0.07);
  --surface-3:  rgba(255,255,255,0.10);
  --border:     rgba(255,255,255,0.08);
  --border-2:   rgba(255,255,255,0.14);
  --text:       #e2e8f0;
  --text-dim:   #94a3b8;
  --text-faint: #4a5568;

  --radius-xs:  6px;
  --radius-sm:  10px;
  --radius:     16px;
  --radius-lg:  22px;

  --shadow-card: 0 4px 24px rgba(0,0,0,0.3), 0 1px 3px rgba(0,0,0,0.2);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: "Sarabun", "Outfit", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

body::before {
  content: "";
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(14,165,160,0.12) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 80% 80%, rgba(99,102,241,0.08) 0%, transparent 60%),
    radial-gradient(ellipse 40% 60% at 90% 20%, rgba(245,158,11,0.05) 0%, transparent 50%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(11,25,41,0.85);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  padding: 10px 20px;
  min-height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.brand {
  display: flex; align-items: center; gap: 10px; flex-shrink: 0;
}
.brand-logo {
  width: 48px; height: 38px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
  box-shadow: 0 0 20px var(--teal-glow);
}
.brand-name {
  font-family: "Outfit", sans-serif;
  font-size: 15px; font-weight: 700;
  color: #fff; line-height: 1; letter-spacing: -0.3px;
}
.brand-sub { font-size: 10px; color: var(--text-dim); font-weight: 400; margin-top: 2px; }

.header-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.btn-header {
  padding: 8px 14px; font-size: 12px; font-weight: 600;
  font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  display: inline-flex; align-items: center; gap: 6px;
  transition: opacity 0.2s, transform 0.15s;
  -webkit-tap-highlight-color: transparent;
  white-space: nowrap;
}
.btn-header:active { opacity: 0.85; transform: scale(0.97); }
.btn-back {
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2);
}
.btn-back:hover { background: var(--surface); color: var(--text); }
.btn-print-test {
  background: linear-gradient(135deg, var(--emerald), #34d399);
  color: #fff;
  box-shadow: 0 2px 12px rgba(16,185,129,0.3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT â€” Desktop: Sidebar + Preview
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.layout {
  position: relative; z-index: 1;
  flex: 1;
  display: grid;
  grid-template-columns: 400px 1fr;
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  background: rgba(17,34,64,0.6);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.sidebar-top {
  padding: 20px;
  border-bottom: 1px solid var(--border);
}
.sidebar-section {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
}
.sidebar-section:last-child { border-bottom: none; }
.section-title {
  font-size: 11px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase;
  color: var(--text-dim); margin-bottom: 12px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM FIELDS (dark)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
label.field-label {
  font-size: 11px; font-weight: 600;
  color: var(--text-dim); display: block; margin-bottom: 4px;
  letter-spacing: 0.3px;
}
.dark-input, .dark-select {
  width: 100%;
  padding: 9px 12px; font-size: 13px;
  font-family: "Sarabun", sans-serif;
  background: var(--surface-2);
  border: 1px solid var(--border-2);
  border-radius: var(--radius-sm);
  color: var(--text); outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  margin-bottom: 10px;
}
.dark-input::placeholder { color: var(--text-faint); }
.dark-input:focus, .dark-select:focus {
  border-color: var(--teal);
  box-shadow: 0 0 0 3px var(--teal-glow);
}
.dark-select option { background: var(--navy-mid); color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LINE BLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.line-block {
  background: var(--surface-2);
  border: 1px solid var(--border-2);
  border-radius: var(--radius-sm);
  padding: 14px;
  margin-bottom: 10px;
  position: relative;
  transition: border-color 0.2s;
}
.line-block:hover { border-color: rgba(255,255,255,0.2); }
.line-block:last-child { margin-bottom: 0; }
.line-block-header {
  display: flex; justify-content: space-between;
  align-items: center; margin-bottom: 12px;
}
.line-block-header strong {
  font-size: 13px; color: var(--teal-light); font-weight: 600;
}

.prop-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.prop-mini { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 8px; }
.prop-grid .dark-select, .prop-mini .dark-input, .prop-mini .dark-select { margin-bottom: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARS HINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.vars-hint {
  background: rgba(14,165,160,0.08);
  border: 1px solid rgba(14,165,160,0.2);
  border-radius: var(--radius-sm);
  padding: 14px; font-size: 12px;
  line-height: 1.8; color: var(--text-dim);
}
.vars-hint strong {
  color: var(--teal-light); display: block;
  margin-bottom: 4px; margin-top: 10px;
  font-size: 11px; letter-spacing: 0.5px; text-transform: uppercase;
}
.vars-hint strong:first-child { margin-top: 0; }
.vars-hint code {
  background: rgba(255,255,255,0.08);
  padding: 2px 6px; border-radius: 4px;
  font-size: 11px; display: inline-block; margin-bottom: 4px;
  color: var(--text); font-family: monospace;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  width: 100%;
  padding: 10px; font-size: 13px; font-weight: 700;
  font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  transition: opacity 0.2s, transform 0.15s;
  display: inline-flex; align-items: center; justify-content: center; gap: 6px;
  margin-bottom: 8px;
  -webkit-tap-highlight-color: transparent;
}
.btn:last-child { margin-bottom: 0; }
.btn:active { opacity: 0.85; transform: scale(0.97); }
.btn-load {
  background: var(--surface-2); color: var(--text);
  border: 1px solid var(--border-2);
}
.btn-load:hover { background: var(--surface-3); }
.btn-add {
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2);
}
.btn-add:hover { background: var(--surface-3); color: var(--text); }
.btn-save {
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  color: #fff;
  box-shadow: 0 2px 16px var(--teal-glow);
}
.btn-del-line {
  background: none;
  border: 1px solid rgba(239,68,68,0.3);
  color: var(--rose);
  padding: 3px 8px; font-size: 11px;
  border-radius: 5px; cursor: pointer; font-weight: 600;
  transition: background 0.2s, color 0.2s;
}
.btn-del-line:hover { background: var(--rose); color: #fff; border-color: var(--rose); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PREVIEW PANE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.preview-pane {
  background: rgba(17,34,64,0.3);
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  gap: 20px; overflow: hidden;
  min-height: 400px;
}
.preview-label {
  font-size: 11px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase;
  color: var(--text-dim);
}
.sticker {
  position: relative;
  width: 80mm; height: 50mm;
  background: #fff; color: #000;
  box-shadow: 0 4px 32px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.2);
  overflow: hidden; border-radius: 4px;
}
.line {
  position: absolute; white-space: pre-wrap; word-break: break-word;
  padding-right: 5px; box-sizing: border-box;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV (Mobile)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
  background: rgba(11,25,41,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border-2);
  padding: 8px 0 max(8px, env(safe-area-inset-bottom));
  grid-template-columns: repeat(5, 1fr);
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 6px 4px;
  font-size: 9px; color: var(--text-dim);
  text-decoration: none; cursor: pointer;
  transition: color 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.nav-item:active { color: var(--teal); }
.nav-icon { font-size: 21px; line-height: 1; }
.nav-item.active { color: var(--teal); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer {
  text-align: center;
  font-size: 11px; color: var(--text-faint);
  padding: 18px;
  border-top: 1px solid var(--border);
  position: relative; z-index: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE â€” Mobile
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  header { padding: 8px 14px; }
  .brand-sub { display: none; }
  .brand-name { font-size: 14px; }

  .layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto;
    overflow: visible;
  }

  .sidebar {
    order: 2;
    border-right: none;
    border-top: 1px solid var(--border);
  }

  .preview-pane {
    order: 1;
    min-height: 260px;
    padding: 24px 16px;
  }

  .sticker {
    transform: scale(0.85);
    transform-origin: center;
  }

  .prop-grid { grid-template-columns: 1fr 1fr; }

  .bottom-nav { display: grid; }
  footer { padding-bottom: 80px; }
}

@media (max-width: 420px) {
  .sticker { transform: scale(0.72); }
  .prop-grid { grid-template-columns: 1fr; }
  .prop-mini { grid-template-columns: 1fr 1fr 1fr; }
}

/* PRINT */
@media print {
  body * { visibility: hidden; }
  #sticker, #sticker * { visibility: visible; }
  #sticker { position: absolute; left: 0; top: 0; box-shadow: none; }
  @page { size: 80mm 50mm; margin: 0; }
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-logo">ğŸšğŸ¾</div>
    <div>
      <div class="brand-name">RMUTTO â€“ VASD</div>
      <div class="brand-sub">Veterinary Academic Service Division</div>
    </div>
  </div>
  <div class="header-actions">
    <button class="btn-header btn-print-test" onclick="window.printTest()">ğŸ–¨ï¸ à¸—à¸”à¸ªà¸­à¸šà¸à¸´à¸¡à¸à¹Œ</button>
    <button class="btn-header btn-back" onclick="location.href__='settings.html'">â¬…ï¸ à¸à¸¥à¸±à¸šà¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</button>
  </div>
</header>

<div class="layout">

  <div class="sidebar">

    <div class="sidebar-top">
      <label class="field-label">à¸›à¸£à¸°à¹€à¸ à¸—à¸ªà¸•à¸´à¹Šà¸à¹€à¸à¸­à¸£à¹Œ</label>
      <select id="templateType" class="dark-select">
        <option value="queue">ğŸ· à¸„à¸´à¸§</option>
        <option value="cage">ğŸ”’ à¸•à¸´à¸”à¸à¸£à¸‡</option>
        <option value="envelope">âœ‰ï¸ à¸•à¸´à¸”à¸‹à¸­à¸‡à¸¢à¸²</option>
        <option value="bag">ğŸ’Š à¸•à¸´à¸”à¸–à¸¸à¸‡à¸¢à¸²</option>
        <option value="vaccine">ğŸ“’ à¸•à¸´à¸”à¸«à¸™à¹‰à¸²à¸ªà¸¡à¸¸à¸”à¸§à¸±à¸„à¸‹à¸µà¸™</option>
        <option value="microchip">ğŸ’³ à¸•à¸´à¸”à¹ƒà¸šà¸£à¸±à¸šà¸£à¸­à¸‡à¹„à¸¡à¹‚à¸„à¸£à¸Šà¸´à¸Ÿ</option>
      </select>
      <button class="btn btn-load" onclick="loadTemplate()">ğŸ”„ à¹‚à¸«à¸¥à¸” Template</button>
    </div>

    <div class="sidebar-section" style="flex:1;overflow-y:auto;">
      <div class="section-title">à¸šà¸£à¸£à¸—à¸±à¸”à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</div>
      <div id="lineEditor"></div>
      <button class="btn btn-add" onclick="addLine()">â• à¹€à¸à¸´à¹ˆà¸¡à¸šà¸£à¸£à¸—à¸±à¸”</button>
    </div>

    <div class="sidebar-section">
      <div class="vars-hint">
        <strong>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œ / à¸„à¸´à¸§</strong>
        <code>{{queue_number}}</code> <code>{{animal_name}}</code> <code>{{species}}</code>
        <code>{{sex}}</code> <code>{{owner_name}}</code> <code>{{phone}}</code> <code>{{services}}</code>

        <strong>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¢à¸² (à¸‰à¸¥à¸²à¸à¸¢à¸²)</strong>
        <code>{{drug_id}}</code> <code>{{dose}}</code> <code>{{freq}}</code>
        <code>{{days}}</code> <code>{{total_pills}}</code>
      </div>
    </div>

    <div class="sidebar-section">
      <button class="btn btn-save" onclick="saveTemplate()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸ Template</button>
    </div>

  </div>

  <div class="preview-pane">
    <span class="preview-label">à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸•à¸´à¹Šà¸à¹€à¸à¸­à¸£à¹Œ (à¸‚à¸™à¸²à¸”à¸ˆà¸£à¸´à¸‡ 80Ã—50 mm)</span>
    <div class="sticker" id="sticker"></div>
  </div>

</div>

<nav class="bottom-nav">
  <a class="nav-item" href__="index.html">
    <span class="nav-icon">ğŸ </span>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸
  </a>
  <a class="nav-item" href__="animals.html">
    <span class="nav-icon">ğŸ¾</span>à¸ªà¸±à¸•à¸§à¹Œ
  </a>
  <a class="nav-item" href__="anesthesia.html">
    <span class="nav-icon">ğŸ’‰</span>à¸§à¸²à¸‡à¸¢à¸²
  </a>
  <a class="nav-item" href__="surgery.html">
    <span class="nav-icon">ğŸ›ï¸</span>à¸œà¹ˆà¸²à¸•à¸±à¸”
  </a>
  <a class="nav-item active" href__="settings.html">
    <span class="nav-icon">âš™ï¸</span>à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²
  </a>
</nav>

<footer>RMUTTO â€“ VASD Â© 2026  Â·  Veterinary Academic Service Division</footer>

<script type="module">
import { supabase } from "./js/supabase.js";

let currentConfig = [];

function renderPreview() {
  const box = document.getElementById("sticker");
  box.innerHTML = "";
  currentConfig.forEach(l => {
    const div = document.createElement("div");
    div.className = "line";
    div.style.left = l.x + "px";
    div.style.top  = l.y + "px";
    div.style.fontSize   = l.size + "px";
    div.style.fontWeight = l.weight;
    div.style.fontFamily = l.font;
    div.style.textAlign  = l.align || "left";
    div.style.width      = `calc(100% - ${l.x}px)`;

    div.innerText = l.text
      .replace("{{queue_number}}","1")
      .replace("{{animal_name}}","à¸™à¹‰à¸­à¸‡à¸–à¸¸à¸‡à¸—à¸­à¸‡")
      .replace("{{species}}","à¹à¸¡à¸§")
      .replace("{{sex}}","à¸œà¸¹à¹‰")
      .replace("{{owner_name}}","à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ")
      .replace("{{phone}}","081-234-5678")
      .replace("{{services}}","à¸—à¸³à¸«à¸¡à¸±à¸™, à¸§à¸±à¸„à¸‹à¸µà¸™")
      .replace("{{drug_id}}","Amoxicillin 250mg")
      .replace("{{dose}}","à¸à¸´à¸™à¸„à¸£à¸±à¹‰à¸‡à¸¥à¸° 1 à¹€à¸¡à¹‡à¸”")
      .replace("{{freq}}","à¸§à¸±à¸™à¸¥à¸° 2 à¸„à¸£à¸±à¹‰à¸‡ (à¹€à¸Šà¹‰à¸²-à¹€à¸¢à¹‡à¸™) à¸«à¸¥à¸±à¸‡à¸­à¸²à¸«à¸²à¸£")
      .replace("{{days}}","5 à¸§à¸±à¸™")
      .replace("{{total_pills}}","10");

    box.appendChild(div);
  });
}

function renderEditor() {
  const area = document.getElementById("lineEditor");
  area.innerHTML = "";
  currentConfig.forEach((l, i) => {
    const block = document.createElement("div");
    block.className = "line-block";
    block.innerHTML = `
      <div class="line-block-header">
        <strong>à¸šà¸£à¸£à¸—à¸±à¸”à¸—à¸µà¹ˆ ${i+1}</strong>
        <button class="btn-del-line" onclick="removeLine(${i})">à¸¥à¸š</button>
      </div>
      <label class="field-label">à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</label>
      <input class="dark-input" value="${l.text}" oninput="updateLine(${i},'text',this.value)" style="margin-bottom:10px;">
      <div class="prop-grid">
        <div>
          <label class="field-label">Font</label>
          <select class="dark-select" onchange="updateLine(${i},'font',this.value)" style="margin-bottom:0">
            <option value="monospace" ${l.font==="monospace"?"selected":""}>Monospace</option>
            <option value="Tahoma" ${l.font==="Tahoma"?"selected":""}>Tahoma</option>
            <option value="'Segoe UI'" ${l.font==="'Segoe UI'"?"selected":""}>Segoe UI</option>
            <option value="'Prompt', sans-serif" ${l.font==="'Prompt', sans-serif"?"selected":""}>Prompt</option>
            <option value="'Kanit', sans-serif" ${l.font==="'Kanit', sans-serif"?"selected":""}>Kanit</option>
            <option value="'Sarabun', sans-serif" ${l.font==="'Sarabun', sans-serif"?"selected":""}>Sarabun</option>
          </select>
        </div>
        <div>
          <label class="field-label">à¸™à¹‰à¸³à¸«à¸™à¸±à¸</label>
          <select class="dark-select" onchange="updateLine(${i},'weight',this.value)" style="margin-bottom:0">
            <option value="normal" ${l.weight==="normal"?"selected":""}>à¸›à¸à¸•à¸´</option>
            <option value="bold"   ${l.weight==="bold"  ?"selected":""}>à¸«à¸™à¸²</option>
          </select>
        </div>
        <div>
          <label class="field-label">à¸ˆà¸±à¸”à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡</label>
          <select class="dark-select" onchange="updateLine(${i},'align',this.value)" style="margin-bottom:0">
            <option value="left"   ${!l.align||l.align==="left"  ?"selected":""}>à¸‹à¹‰à¸²à¸¢</option>
            <option value="center" ${l.align==="center"?"selected":""}>à¸à¸¥à¸²à¸‡</option>
            <option value="right"  ${l.align==="right" ?"selected":""}>à¸‚à¸§à¸²</option>
          </select>
        </div>
      </div>
      <div class="prop-mini">
        <div><label class="field-label">à¸‚à¸™à¸²à¸” (px)</label><input class="dark-input" type="number" value="${l.size}" oninput="updateLine(${i},'size',this.value)" style="margin-bottom:0"></div>
        <div><label class="field-label">X (à¸‹à¹‰à¸²à¸¢)</label><input class="dark-input" type="number" value="${l.x}" oninput="updateLine(${i},'x',this.value)" style="margin-bottom:0"></div>
        <div><label class="field-label">Y (à¸šà¸™)</label><input class="dark-input" type="number" value="${l.y}" oninput="updateLine(${i},'y',this.value)" style="margin-bottom:0"></div>
      </div>
    `;
    area.appendChild(block);
  });
}

window.updateLine = function(i, key, val) {
  if (["size","x","y"].includes(key)) val = parseInt(val)||0;
  currentConfig[i][key] = val;
  renderPreview();
};
window.removeLine = function(i) {
  currentConfig.splice(i,1);
  renderEditor(); renderPreview();
};
window.addLine = function() {
  currentConfig.push({ text:"à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆ", font:"'Prompt', sans-serif", size:16, x:10, y:10, weight:"normal", align:"left" });
  renderEditor(); renderPreview();
};
window.loadTemplate = async function() {
  const { data } = await supabase.from("vasd_print_template").select("*").eq("template_type", document.getElementById("templateType").value).single();
  currentConfig = data?.config || [];
  renderEditor(); renderPreview();
};
window.saveTemplate = async function() {
  const type = document.getElementById("templateType").value;
  const { error } = await supabase.from("vasd_print_template").upsert({ template_type:type, config:currentConfig },{ onConflict:"template_type" });
  if (error) alert("âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: "+error.message);
  else alert("âœ… à¸šà¸±à¸™à¸—à¸¶à¸ Template \""+type+"\" à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§");
};
window.printTest = function() {
  const contents = document.getElementById("sticker").innerHTML;
  const pw = window.open("","_blank","width=800,height=600");
  pw.document.write(`<html><head><title>Print Test</title>
    <link href__="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&family=Prompt:wght@400;700&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>body{margin:0}.sticker{position:relative;width:80mm;height:50mm;background:#fff;overflow:hidden}.line{position:absolute;white-space:pre-wrap;word-break:break-word;padding-right:5px;box-sizing:border-box;}@page{size:80mm 50mm;margin:0}</style>
    </head><body><div class="sticker">${contents}</div>
    <script>window.onload=function(){document.fonts.ready.then(()=>{setTimeout(()=>{window.print();window.close();},300);});}<\/script></body></html>`);
  pw.document.close();
};

loadTemplate();
</script>
</body>
</html>
