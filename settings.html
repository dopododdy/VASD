<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>VASD - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:"Segoe UI",sans-serif;background:#f4f6f8;}
header{
  background:#fff;border-bottom:1px solid #ddd;
  padding:14px 20px;display:flex;
  justify-content:space-between;align-items:center;
}
.container{
  display:grid;
  grid-template-columns:400px 1fr;
  height:calc(100vh - 70px);
}
.sidebar{
  background:#fff;padding:15px;overflow:auto;
  border-right:1px solid #ddd;
}
.preview{
  display:flex;justify-content:center;align-items:center;
  background:#e9ecef;
}
.sticker{
  position:relative;
  width:80mm;
  height:50mm;
  background:#fff;
  box-shadow:0 0 10px rgba(0,0,0,0.2);
}
.line{
  position:absolute;
}
input,select{width:100%;margin-bottom:8px;}
button{
  padding:6px 10px;border:none;
  border-radius:4px;background:#2c7be5;
  color:#fff;cursor:pointer;margin-bottom:6px;
}
.line-block{
  border:1px solid #ddd;
  padding:8px;margin-bottom:8px;
}
.small{font-size:12px;color:#888;}
</style>
</head>
<body>

<header>
  <h3>üñ® ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Sticker Template</h3>
  <button onclick="location.href='index.html'">üè† Home</button>
</header>

<div class="container">

<div class="sidebar">

<label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå</label>
<select id="templateType">
  <option value="queue">‡∏Ñ‡∏¥‡∏ß</option>
  <option value="cage">‡∏ï‡∏¥‡∏î‡∏Å‡∏£‡∏á</option>
  <option value="envelope">‡∏ï‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏¢‡∏≤</option>
  <option value="bag">‡∏ï‡∏¥‡∏î‡∏ñ‡∏∏‡∏á‡∏¢‡∏≤</option>
  <option value="vaccine">‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏∏‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</option>
  <option value="microchip">‡∏ï‡∏¥‡∏î‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡∏ä‡∏¥‡∏ü</option>
</select>

<button onclick="loadTemplate()">‡πÇ‡∏´‡∏•‡∏î Template</button>

<hr>

<div id="lineEditor"></div>

<button onclick="addLine()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</button>
<button onclick="saveTemplate()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Template</button>

<p class="small">
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£:<br>
{{queue_number}}<br>
{{animal_name}}<br>
{{species}}<br>
{{sex}}<br>
{{owner_name}}<br>
</p>

</div>

<div class="preview">
  <div class="sticker" id="sticker"></div>
</div>

</div>

<script type="module">
import { supabase } from "./js/supabase.js";

let currentConfig = [];

function renderPreview(){
  const box = document.getElementById("sticker");
  box.innerHTML = "";
  currentConfig.forEach((l,i)=>{
    const div = document.createElement("div");
    div.className="line";
    div.style.left=l.x+"px";
    div.style.top=l.y+"px";
    div.style.fontSize=l.size+"px";
    div.style.fontWeight=l.weight;
    div.style.fontFamily=l.font;
    div.innerText=l.text;
    box.appendChild(div);
  });
}

function renderEditor(){
  const area = document.getElementById("lineEditor");
  area.innerHTML="";
  currentConfig.forEach((l,i)=>{
    const block=document.createElement("div");
    block.className="line-block";
    block.innerHTML=`
      <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
      <input value="${l.text}" onchange="updateLine(${i},'text',this.value)">
      <label>Font</label>
      <select onchange="updateLine(${i},'font',this.value)">
        <option ${l.font==="monospace"?"selected":""}>monospace</option>
        <option ${l.font==="Arial"?"selected":""}>Arial</option>
        <option ${l.font==="Tahoma"?"selected":""}>Tahoma</option>
      </select>
      <label>‡∏Ç‡∏ô‡∏≤‡∏î</label>
      <input type="number" value="${l.size}" onchange="updateLine(${i},'size',this.value)">
      <label>X</label>
      <input type="number" value="${l.x}" onchange="updateLine(${i},'x',this.value)">
      <label>Y</label>
      <input type="number" value="${l.y}" onchange="updateLine(${i},'y',this.value)">
      <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</label>
      <select onchange="updateLine(${i},'weight',this.value)">
        <option ${l.weight==="normal"?"selected":""}>normal</option>
        <option ${l.weight==="bold"?"selected":""}>bold</option>
      </select>
      <button onclick="removeLine(${i})" style="background:#dc3545">‡∏•‡∏ö</button>
    `;
    area.appendChild(block);
  });
}

window.updateLine=function(i,key,val){
  if(key==="size"||key==="x"||key==="y") val=parseInt(val);
  currentConfig[i][key]=val;
  renderPreview();
}

window.removeLine=function(i){
  currentConfig.splice(i,1);
  renderEditor();
  renderPreview();
}

window.addLine=function(){
  currentConfig.push({
    text:"‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà",
    font:"monospace",
    size:14,
    x:10,
    y:10,
    weight:"normal"
  });
  renderEditor();
  renderPreview();
}

window.loadTemplate=async function(){
  const { data } = await supabase
    .from("vasd_print_template")
    .select("*")
    .eq("template_type",templateType.value)
    .single();

  if(data){
    currentConfig=data.config;
  }else{
    currentConfig=[];
  }

  renderEditor();
  renderPreview();
}

window.saveTemplate=async function(){
  await supabase
    .from("vasd_print_template")
    .upsert({
      template_type:templateType.value,
      config:currentConfig
    });

  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

loadTemplate();
</script>

</body>
</html>
