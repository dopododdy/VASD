<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Database Management â€“ RMUTTO VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS (Match with index.html)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --navy-card:  #162d4a;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.25);
  --danger:     #ef4444;
  --surface:    rgba(255,255,255,0.04);
  --surface-2:  rgba(255,255,255,0.08);
  --border:     rgba(255,255,255,0.08);
  --border-2:   rgba(255,255,255,0.14);
  --text:       #e2e8f0;
  --text-dim:   #94a3b8;
  --radius:     20px;
  --radius-sm:  12px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: "Sarabun", "Outfit", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
  padding-bottom: 90px; /* Space for bottom nav */
}

/* Background Mesh Gradient */
body::before {
  content: "";
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(14,165,160,0.12) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 80% 80%, rgba(99,102,241,0.08) 0%, transparent 60%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(11,25,41,0.8);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 15px 20px;
  display: flex; align-items: center; gap: 15px;
}
.btn-back {
  background: var(--surface-2); border: 1px solid var(--border-2);
  color: #fff; width: 40px; height: 40px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; text-decoration: none; transition: 0.2s;
}
.btn-back:hover { background: var(--border-2); }
.header-title { font-family: "Outfit", sans-serif; font-size: 18px; font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.container {
  position: relative; z-index: 1;
  max-width: 800px; margin: 30px auto;
  padding: 0 20px; width: 100%;
}

.card {
  background: var(--surface);
  backdrop-filter: blur(10px);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 25px;
  margin-bottom: 25px;
}

.section-label {
  font-family: "Outfit", sans-serif; font-size: 12px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 1.5px; color: var(--teal-light);
  margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
}

/* Statistics Grid */
.stat-grid {
  display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
}
.stat-item {
  background: var(--navy-mid);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 20px;
  display: flex; flex-direction: column; gap: 5px;
}
.stat-val {
  font-family: "Outfit", sans-serif; font-size: 28px; font-weight: 700; color: #fff;
}
.stat-label { font-size: 12px; color: var(--text-dim); }

/* Danger Zone */
.danger-box {
  border: 1px solid rgba(239, 68, 68, 0.2);
  background: rgba(239, 68, 68, 0.03);
  border-radius: var(--radius);
  padding: 25px;
}
.danger-title { color: var(--danger); font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
.danger-desc { font-size: 13px; color: var(--text-dim); line-height: 1.6; margin-bottom: 20px; }

.btn-danger {
  width: 100%; padding: 16px; background: rgba(239, 68, 68, 0.1);
  color: var(--danger); border: 1px solid var(--danger);
  border-radius: var(--radius-sm); cursor: pointer; font-weight: 700;
  font-family: "Sarabun", sans-serif; transition: 0.3s;
}
.btn-danger:hover { background: var(--danger); color: #fff; box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;
  background: rgba(11, 25, 41, 0.85); backdrop-filter: blur(20px);
  border-top: 1px solid var(--border); display: flex; justify-content: space-around;
  padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 4px;
  text-decoration: none; color: var(--text-dim); transition: 0.3s; flex: 1;
}
.nav-icon { font-size: 20px; }
.nav-label { font-size: 10px; font-weight: 600; font-family: "Sarabun", sans-serif; }
.nav-item.active { color: var(--teal-light); }

@media (max-width: 500px) {
  .stat-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<header>
  <a href="settings.html" class="btn-back">â†</a>
  <div class="header-title">Database Management</div>
</header>

<div class="container">
  <section class="card">
    <div class="section-label"><span>ğŸ“Š</span> System Overview</div>
    <div class="stat-grid">
      <div class="stat-item">
        <div class="stat-val" id="count-animal">0</div>
        <div class="stat-label">à¸ªà¸±à¸•à¸§à¹Œà¸—à¸µà¹ˆà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</div>
      </div>
      <div class="stat-item">
        <div class="stat-val" id="count-queue">0</div>
        <div class="stat-label">à¸£à¸²à¸¢à¸à¸²à¸£à¹ƒà¸™à¸„à¸´à¸§à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™</div>
      </div>
      <div class="stat-item">
        <div class="stat-val" id="count-service">0</div>
        <div class="stat-label">à¸«à¸±à¸•à¸–à¸à¸²à¸£à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰</div>
      </div>
      <div class="stat-item">
        <div class="stat-val" id="count-rx">0</div>
        <div class="stat-label">à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¹ˆà¸‡à¸ˆà¹ˆà¸²à¸¢à¸¢à¸²</div>
      </div>
    </div>
  </section>

  <section class="card danger-box">
    <div class="danger-title"><span>âš ï¸</span> DANGER ZONE</div>
    <p class="danger-desc">
      à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œ (Animal), à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡ (Owner), à¸„à¸´à¸§ (Queue), à¸ªà¸±à¸à¸à¸²à¸“à¸Šà¸µà¸ à¹à¸¥à¸°à¹ƒà¸šà¸ªà¸±à¹ˆà¸‡à¸¢à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸­à¸­à¸à¸–à¸²à¸§à¸£ 
      à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¹‚à¸„à¸£à¸‡à¸à¸²à¸£à¸„à¹ˆà¸²à¸¢à¸­à¸²à¸ªà¸²à¸„à¸£à¸±à¹‰à¸‡à¹ƒà¸«à¸¡à¹ˆ <br>
      <i>* à¹à¸¡à¹ˆà¹à¸šà¸šà¸ªà¸•à¸´à¹Šà¸à¹€à¸à¸­à¸£à¹Œ (Print Templates) à¸ˆà¸°à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸¥à¸š</i>
    </p>
    
    <button class="btn-danger" onclick="handleClearDatabase()">
      ğŸ”¥ à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œà¹à¸¥à¸°à¸„à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
    </button>
  </section>
  
  <div style="text-align: center; color: var(--text-dim); font-size: 11px;">
    Database Status: <span style="color: var(--teal-light);">Connected to Supabase</span>
  </div>
</div>

<nav class="bottom-nav">
  <a href="index.html" class="nav-item">
    <span class="nav-icon">ğŸ“Š</span>
    <span class="nav-label">à¹à¸”à¸Šà¸šà¸­à¸£à¹Œà¸”</span>
  </a>
  <a href="queue.html" class="nav-item">
    <span class="nav-icon">â³</span>
    <span class="nav-label">à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¸´à¸§</span>
  </a>
  <a href="opd.html" class="nav-item">
    <span class="nav-icon">ğŸ©º</span>
    <span class="nav-label">à¸«à¹‰à¸­à¸‡à¸•à¸£à¸§à¸ˆ</span>
  </a>
  <a href="settings.html" class="nav-item active">
    <span class="nav-icon">âš™ï¸</span>
    <span class="nav-label">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</span>
  </a>
</nav>

<script type="module">
import { supabase } from "./js/supabase.js";

// 1. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
async function updateStats() {
  const tables = [
    { table: 'vasd_animal', id: 'count-animal' },
    { table: 'vasd_queue', id: 'count-queue' },
    { table: 'vasd_service', id: 'count-service' },
    { table: 'vasd_prescription', id: 'count-rx' }
  ];

  for (const item of tables) {
    const { count, error } = await supabase
      .from(item.table)
      .select('*', { count: 'exact', head: true });
    
    if (!error) {
      document.getElementById(item.id).innerText = count.toLocaleString();
    }
  }
}

// 2. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Dangerous)
window.handleClearDatabase = async function() {
  // à¸¢à¸·à¸™à¸¢à¸±à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 1
  if (!confirm("ğŸš¨ à¸„à¸³à¹€à¸•à¸·à¸­à¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸”: à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œà¹à¸¥à¸°à¸„à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?\nà¸à¸²à¸£à¸à¸£à¸°à¸—à¸³à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¹‰à¸­à¸™à¸„à¸·à¸™à¹„à¸”à¹‰!")) {
    return;
  }

  // à¸¢à¸·à¸™à¸¢à¸±à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 2: à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™
  const password = prompt("à¸à¸£à¸¸à¸“à¸²à¸›à¹‰à¸­à¸™à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š (Admin Password) à¹€à¸à¸·à¹ˆà¸­à¸¢à¸·à¸™à¸¢à¸±à¸™:");
  if (password !== '2500') {
    alert("âŒ à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡");
    return;
  }

  try {
    // à¸à¸²à¸£à¸¥à¸š vasd_animal à¸ˆà¸°à¸ªà¹ˆà¸‡à¸œà¸¥ Cascade Delete à¹„à¸›à¸¢à¸±à¸‡ Queue, Service, Prescription, VitalSigns à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ (à¸•à¸²à¸¡ SQL Schema)
    // à¹€à¸£à¸²à¸¥à¸šà¸ªà¸±à¸•à¸§à¹Œà¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ Event à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸¢à¸à¹€à¸§à¹‰à¸™ Template)
    const { error } = await supabase
      .from('vasd_animal')
      .delete()
      .neq('id', '00000000-0000-0000-0000-000000000000'); // Delete all

    if (error) throw error;

    alert("âœ… à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§ à¸£à¸°à¸šà¸šà¸à¸³à¸¥à¸±à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ...");
    window.location.reload();

  } catch (err) {
    alert("âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: " + err.message);
  }
};

// Initial Load
updateStats();
</script>
</body>
</html>
