<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ â€“ RMUTTO VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<link href__="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --navy-card:  #162d4a;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.25);
  --amber:      #f59e0b;
  --rose:       #ef4444;
  --violet:     #8b5cf6;
  --sky:        #3b82f6;
  --emerald:    #10b981;
  --slate:      #64748b;

  --surface:    rgba(255,255,255,0.04);
  --surface-2:  rgba(255,255,255,0.07);
  --surface-3:  rgba(255,255,255,0.10);
  --border:     rgba(255,255,255,0.08);
  --border-2:   rgba(255,255,255,0.14);
  --text:       #e2e8f0;
  --text-dim:   #94a3b8;
  --text-faint: #4a5568;

  --radius-xs:  6px;
  --radius-sm:  10px;
  --radius:     16px;
  --radius-lg:  22px;

  --shadow-card: 0 4px 24px rgba(0,0,0,0.3), 0 1px 3px rgba(0,0,0,0.2);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: "Sarabun", "Outfit", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

body::before {
  content: "";
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(14,165,160,0.12) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 80% 80%, rgba(99,102,241,0.08) 0%, transparent 60%),
    radial-gradient(ellipse 40% 60% at 90% 20%, rgba(245,158,11,0.05) 0%, transparent 50%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(11,25,41,0.85);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  padding: 10px 20px;
  min-height: 64px;
  display: flex; align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.brand {
  display: flex; align-items: center; gap: 10px; flex-shrink: 0;
}
.brand-logo {
  width: 48px; height: 38px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
  box-shadow: 0 0 20px var(--teal-glow);
}
.brand-name {
  font-family: "Outfit", sans-serif;
  font-size: 15px; font-weight: 700;
  color: #fff; line-height: 1; letter-spacing: -0.3px;
}
.brand-sub { font-size: 10px; color: var(--text-dim); font-weight: 400; margin-top: 2px; }

.header-actions { display: flex; gap: 8px; align-items: center; }
.btn-header {
  padding: 8px 14px; font-size: 12px; font-weight: 600;
  font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  display: inline-flex; align-items: center; gap: 6px;
  transition: opacity 0.2s, transform 0.15s;
  -webkit-tap-highlight-color: transparent;
}
.btn-header:active { opacity: 0.85; transform: scale(0.97); }
.btn-back {
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2);
}
.btn-back:hover { background: var(--surface); color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap {
  position: relative; z-index: 1;
  max-width: 700px; margin: 0 auto;
  padding: 28px 18px 100px;
  width: 100%;
}
.page-header {
  margin-bottom: 28px;
  animation: slideUp 0.4s ease both;
}
.page-title {
  font-family: "Outfit", sans-serif;
  font-size: 26px; font-weight: 800;
  color: #fff; letter-spacing: -0.5px;
  margin-bottom: 6px;
}
.page-desc {
  font-size: 13px; color: var(--text-dim); line-height: 1.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.action-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 16px;
  animation: slideUp 0.5s ease both;
  transition: border-color 0.25s;
}
.action-card:hover { border-color: var(--border-2); }
.action-card:nth-child(1) { animation-delay: 0.1s; }
.action-card:nth-child(2) { animation-delay: 0.15s; }
.action-card:nth-child(3) { animation-delay: 0.2s; }
.action-card:nth-child(4) { animation-delay: 0.25s; }

.action-header {
  display: flex; align-items: center; gap: 14px; margin-bottom: 12px;
}
.action-icon {
  width: 44px; height: 44px;
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px; flex-shrink: 0;
}
.icon-emerald { background: rgba(16,185,129,0.15); }
.icon-sky     { background: rgba(59,130,246,0.15); }
.icon-amber   { background: rgba(245,158,11,0.15); }
.icon-rose    { background: rgba(239,68,68,0.15); }

.action-title {
  font-family: "Outfit", sans-serif;
  font-size: 16px; font-weight: 700; color: #fff;
  margin-bottom: 2px;
}
.action-desc {
  font-size: 12px; color: var(--text-dim); line-height: 1.5;
}

.action-body {
  margin-top: 16px;
}

.btn-action {
  width: 100%;
  padding: 12px; font-size: 14px; font-weight: 700;
  font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  transition: opacity 0.2s, transform 0.15s;
  -webkit-tap-highlight-color: transparent;
}
.btn-action:active { opacity: 0.85; transform: scale(0.97); }

.btn-export {
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  color: #fff;
  box-shadow: 0 2px 16px var(--teal-glow);
}
.btn-import {
  background: linear-gradient(135deg, var(--sky), #60a5fa);
  color: #fff;
  box-shadow: 0 2px 16px rgba(59,130,246,0.3);
}
.btn-clear-today {
  background: linear-gradient(135deg, var(--amber), #fbbf24);
  color: #000;
  box-shadow: 0 2px 16px rgba(245,158,11,0.3);
}
.btn-reset {
  background: linear-gradient(135deg, var(--rose), #f87171);
  color: #fff;
  box-shadow: 0 2px 16px rgba(239,68,68,0.3);
}

/* hidden file input */
.hidden-input { display: none; }

/* status message */
.status-msg {
  margin-top: 12px;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  font-size: 13px; font-weight: 500;
  display: none;
  animation: slideUp 0.3s ease;
}
.status-success {
  background: rgba(16,185,129,0.15); color: var(--emerald);
  border: 1px solid rgba(16,185,129,0.3);
}
.status-error {
  background: rgba(239,68,68,0.15); color: var(--rose);
  border: 1px solid rgba(239,68,68,0.3);
}

/* Warning box */
.warning-box {
  background: rgba(239,68,68,0.08);
  border: 1px solid rgba(239,68,68,0.2);
  border-radius: var(--radius-sm);
  padding: 12px 14px; margin-bottom: 16px;
  font-size: 12px; color: #fca5a5;
  line-height: 1.6;
}
.warning-box strong { color: var(--rose); }

/* Table info */
.table-list {
  display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px;
}
.table-tag {
  padding: 4px 10px; font-size: 11px; font-weight: 600;
  background: var(--surface-2); border: 1px solid var(--border-2);
  border-radius: 20px; color: var(--text-dim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV (Mobile)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
  background: rgba(11,25,41,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border-2);
  padding: 8px 0 max(8px, env(safe-area-inset-bottom));
  grid-template-columns: repeat(5, 1fr);
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 6px 4px;
  font-size: 9px; color: var(--text-dim);
  text-decoration: none; cursor: pointer;
  transition: color 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.nav-item:active { color: var(--teal); }
.nav-icon { font-size: 21px; line-height: 1; }
.nav-item.active { color: var(--teal); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer {
  text-align: center;
  font-size: 11px; color: var(--text-faint);
  padding: 18px;
  border-top: 1px solid var(--border);
  position: relative; z-index: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 640px) {
  header { padding: 8px 14px; }
  .brand-sub { display: none; }
  .brand-name { font-size: 14px; }
  .wrap { padding: 20px 14px 80px; }
  .page-title { font-size: 22px; }
  .action-card { padding: 18px 16px; }
  .bottom-nav { display: grid; }
}

@media (min-width: 900px) {
  .wrap { padding: 36px 24px 60px; }
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-logo">ğŸšğŸ¾</div>
    <div>
      <div class="brand-name">RMUTTO â€“ VASD</div>
      <div class="brand-sub">Veterinary Academic Service Division</div>
    </div>
  </div>
  <div class="header-actions">
    <button class="btn-header btn-back" onclick="location.href__='settings.html'">â¬…ï¸ à¸à¸¥à¸±à¸šà¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</button>
  </div>
</header>

<div class="wrap">

  <div class="page-header">
    <div class="page-title">ğŸ—„ï¸ à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</div>
    <div class="page-desc">à¸ªà¸³à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥, à¸™à¸³à¹€à¸‚à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥, à¸¥à¹‰à¸²à¸‡à¸„à¸´à¸§à¸§à¸±à¸™à¸™à¸µà¹‰ à¸«à¸£à¸·à¸­à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸°à¸šà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</div>
  </div>

  <div class="table-list">
    <span class="table-tag">vasd_queue</span>
    <span class="table-tag">vasd_animals</span>
    <span class="table-tag">vasd_print_template</span>
    <span class="table-tag">vasd_drug_catalog</span>
  </div>

  <!-- â”€â”€ Export â”€â”€ -->
  <div class="action-card">
    <div class="action-header">
      <div class="action-icon icon-emerald">ğŸ“¤</div>
      <div>
        <div class="action-title">à¸ªà¸³à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Export)</div>
        <div class="action-desc">à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸à¸•à¸²à¸£à¸²à¸‡à¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸¥à¹Œ JSON à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¹‡à¸šà¸ªà¸³à¸£à¸­à¸‡</div>
      </div>
    </div>
    <div class="action-body">
      <button class="btn-action btn-export" onclick="exportData()">ğŸ“¥ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸£à¸­à¸‡</button>
      <div id="exportStatus" class="status-msg"></div>
    </div>
  </div>

  <!-- â”€â”€ Import â”€â”€ -->
  <div class="action-card">
    <div class="action-header">
      <div class="action-icon icon-sky">ğŸ“¥</div>
      <div>
        <div class="action-title">à¸™à¸³à¹€à¸‚à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Import)</div>
        <div class="action-desc">à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œ JSON à¸—à¸µà¹ˆà¹€à¸„à¸¢à¸ªà¸³à¸£à¸­à¸‡à¹„à¸§à¹‰à¹€à¸à¸·à¹ˆà¸­à¸à¸¹à¹‰à¸„à¸·à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</div>
      </div>
    </div>
    <div class="action-body">
      <input type="file" id="importFile" accept=".json" class="hidden-input" onchange="importData(event)">
      <button class="btn-action btn-import" onclick="document.getElementById('importFile').click()">ğŸ“‚ à¹€à¸¥à¸·à¸­à¸à¹„à¸Ÿà¸¥à¹Œà¹à¸¥à¸°à¸™à¸³à¹€à¸‚à¹‰à¸²</button>
      <div id="importStatus" class="status-msg"></div>
    </div>
  </div>

  <!-- â”€â”€ Clear Today â”€â”€ -->
  <div class="action-card">
    <div class="action-header">
      <div class="action-icon icon-amber">ğŸ§¹</div>
      <div>
        <div class="action-title">à¸¥à¹‰à¸²à¸‡à¸„à¸´à¸§à¸§à¸±à¸™à¸™à¸µà¹‰</div>
        <div class="action-desc">à¸¥à¸šà¹€à¸‰à¸à¸²à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸´à¸§ (vasd_queue) à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸µà¹‰ à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸«à¸¡à¹ˆ</div>
      </div>
    </div>
    <div class="action-body">
      <button class="btn-action btn-clear-today" onclick="clearToday()">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¸„à¸´à¸§à¸§à¸±à¸™à¸™à¸µà¹‰</button>
      <div id="clearTodayStatus" class="status-msg"></div>
    </div>
  </div>

  <!-- â”€â”€ Reset All â”€â”€ -->
  <div class="action-card">
    <div class="action-header">
      <div class="action-icon icon-rose">âš ï¸</div>
      <div>
        <div class="action-title">à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸°à¸šà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</div>
        <div class="action-desc">à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š (à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸¹à¹‰à¸„à¸·à¸™à¹„à¸”à¹‰!)</div>
      </div>
    </div>
    <div class="action-body">
      <div class="warning-box">
        <strong>âš ï¸ à¸„à¸³à¹€à¸•à¸·à¸­à¸™:</strong> à¸à¸²à¸£à¸£à¸µà¹€à¸‹à¹‡à¸•à¸ˆà¸°à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹ƒà¸™à¸£à¸°à¸šà¸šà¸­à¸¢à¹ˆà¸²à¸‡à¸–à¸²à¸§à¸£ à¸£à¸§à¸¡à¸–à¸¶à¸‡à¸„à¸´à¸§, à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œ, Template à¹à¸¥à¸°à¸£à¸²à¸¢à¸à¸²à¸£à¸¢à¸² à¸à¸£à¸¸à¸“à¸²à¸ªà¸³à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¹ˆà¸­à¸™à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£
      </div>
      <button class="btn-action btn-reset" onclick="resetAll()">ğŸ’¥ à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸°à¸šà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
      <div id="resetStatus" class="status-msg"></div>
    </div>
  </div>

</div>

<nav class="bottom-nav">
  <a class="nav-item" href__="index.html">
    <span class="nav-icon">ğŸ </span>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸
  </a>
  <a class="nav-item" href__="animals.html">
    <span class="nav-icon">ğŸ¾</span>à¸ªà¸±à¸•à¸§à¹Œ
  </a>
  <a class="nav-item" href__="anesthesia.html">
    <span class="nav-icon">ğŸ’‰</span>à¸§à¸²à¸‡à¸¢à¸²
  </a>
  <a class="nav-item" href__="surgery.html">
    <span class="nav-icon">ğŸ›ï¸</span>à¸œà¹ˆà¸²à¸•à¸±à¸”
  </a>
  <a class="nav-item active" href__="settings.html">
    <span class="nav-icon">âš™ï¸</span>à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²
  </a>
</nav>

<footer>RMUTTO â€“ VASD Â© 2026  Â·  Veterinary Academic Service Division</footer>

<script type="module">
import { supabase } from "./js/supabase.js";

const TABLES = ["vasd_queue", "vasd_animals", "vasd_print_template", "vasd_drug_catalog"];

function showStatus(id, message, isError = false) {
  const el = document.getElementById(id);
  el.textContent = message;
  el.className = `status-msg ${isError ? "status-error" : "status-success"}`;
  el.style.display = "block";
  setTimeout(() => { el.style.display = "none"; }, 6000);
}

/* â”€â”€ Export â”€â”€ */
window.exportData = async function() {
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = "â³ à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸­à¸­à¸...";

  const backup = {};
  for (const table of TABLES) {
    const { data, error } = await supabase.from(table).select("*");
    if (error) {
      showStatus("exportStatus", `âŒ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸­à¹ˆà¸²à¸™à¸•à¸²à¸£à¸²à¸‡ ${table}: ${error.message}`, true);
      btn.disabled = false;
      btn.textContent = "ğŸ“¥ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸£à¸­à¸‡";
      return;
    }
    backup[table] = data;
  }

  const blob = new Blob([JSON.stringify(backup, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `vasd_backup_${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);

  const totalRows = Object.values(backup).reduce((sum, rows) => sum + rows.length, 0);
  showStatus("exportStatus", `âœ… à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ â€” ${TABLES.length} à¸•à¸²à¸£à¸²à¸‡, ${totalRows} à¸£à¸²à¸¢à¸à¸²à¸£`);
  btn.disabled = false;
  btn.textContent = "ğŸ“¥ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸£à¸­à¸‡";
};

/* â”€â”€ Import â”€â”€ */
window.importData = async function(event) {
  const file = event.target.files[0];
  if (!file) return;

  if (!confirm("âš ï¸ à¸à¸²à¸£à¸™à¸³à¹€à¸‚à¹‰à¸²à¸ˆà¸°à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸²à¹„à¸›à¹ƒà¸™à¸£à¸°à¸šà¸š (à¹„à¸¡à¹ˆà¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸”à¸´à¸¡)\nà¸¢à¸·à¸™à¸¢à¸±à¸™à¸ˆà¸°à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£?")) {
    event.target.value = "";
    return;
  }

  const text = await file.text();
  let backup;
  try {
    backup = JSON.parse(text);
  } catch {
    showStatus("importStatus", "âŒ à¹„à¸Ÿà¸¥à¹Œ JSON à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡", true);
    event.target.value = "";
    return;
  }

  let imported = 0;
  for (const table of TABLES) {
    if (backup[table] && backup[table].length > 0) {
      const { error } = await supabase.from(table).upsert(backup[table], { onConflict: "id" });
      if (error) {
        showStatus("importStatus", `âŒ à¸™à¸³à¹€à¸‚à¹‰à¸² ${table} à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${error.message}`, true);
        event.target.value = "";
        return;
      }
      imported += backup[table].length;
    }
  }

  showStatus("importStatus", `âœ… à¸™à¸³à¹€à¸‚à¹‰à¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ â€” ${imported} à¸£à¸²à¸¢à¸à¸²à¸£`);
  event.target.value = "";
};

/* â”€â”€ Clear Today â”€â”€ */
window.clearToday = async function() {
  const today = new Date().toISOString().slice(0, 10);
  if (!confirm(`âš ï¸ à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ ${today} ?\nà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸¥à¸šà¸ˆà¸°à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸¹à¹‰à¸„à¸·à¸™à¹„à¸”à¹‰`)) return;

  const { error, count } = await supabase
    .from("vasd_queue")
    .delete({ count: "exact" })
    .gte("created_at", today + "T00:00:00")
    .lte("created_at", today + "T23:59:59");

  if (error) {
    showStatus("clearTodayStatus", `âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${error.message}`, true);
  } else {
    showStatus("clearTodayStatus", `âœ… à¸¥à¸šà¸„à¸´à¸§à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ â€” ${count || 0} à¸£à¸²à¸¢à¸à¸²à¸£`);
  }
};

/* â”€â”€ Reset All â”€â”€ */
window.resetAll = async function() {
  const confirmText = prompt("âš ï¸ à¸à¸´à¸¡à¸à¹Œ \"RESET\" à¹€à¸à¸·à¹ˆà¸­à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸°à¸šà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:");
  if (confirmText !== "RESET") {
    if (confirmText !== null) showStatus("resetStatus", "âŒ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸™ â€” à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸£à¸µà¹€à¸‹à¹‡à¸•", true);
    return;
  }

  let deleted = 0;
  for (const table of TABLES) {
    const { error, count } = await supabase.from(table).delete({ count: "exact" }).neq("id", 0);
    if (error) {
      showStatus("resetStatus", `âŒ à¸¥à¸š ${table} à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${error.message}`, true);
      return;
    }
    deleted += (count || 0);
  }

  showStatus("resetStatus", `âœ… à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸°à¸šà¸šà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ â€” à¸¥à¸š ${deleted} à¸£à¸²à¸¢à¸à¸²à¸£à¸ˆà¸²à¸ ${TABLES.length} à¸•à¸²à¸£à¸²à¸‡`);
};
</script>
</body>
</html>
