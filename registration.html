<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸±à¸•à¸§à¹Œ â€“ VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&family=Kanit:wght@300;400;500;700&family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS (matches index.html)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --navy-card:  #162d4a;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.25);
  --amber:      #f59e0b;
  --rose:       #ef4444;
  --rose-soft:  rgba(239,68,68,0.15);
  --emerald:    #10b981;
  --emerald-soft: rgba(16,185,129,0.15);
  --violet:     #8b5cf6;

  --surface:    rgba(255,255,255,0.04);
  --surface-2:  rgba(255,255,255,0.07);
  --surface-3:  rgba(255,255,255,0.10);
  --border:     rgba(255,255,255,0.08);
  --border-2:   rgba(255,255,255,0.14);
  --text:       #e2e8f0;
  --text-dim:   #94a3b8;
  --text-faint: #4a5568;

  --radius-xs:  6px;
  --radius-sm:  10px;
  --radius:     16px;
  --radius-lg:  22px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: "Sarabun", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh; min-height: 100dvh;
  display: flex; flex-direction: column;
  overflow-x: hidden;
}

/* Mesh background */
body::before {
  content: ""; position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(14,165,160,0.10) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 80% 80%, rgba(99,102,241,0.07) 0%, transparent 60%);
}

/* Font preload */
.font-preload { position: absolute; opacity: 0; pointer-events: none; z-index: -9999; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(11,25,41,0.88);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  height: 64px;
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
}

.brand { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.brand-logo {
  width: 38px; height: 38px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center; font-size: 18px;
  box-shadow: 0 0 20px var(--teal-glow);
}
.brand-name {
  font-family: "Outfit", sans-serif;
  font-size: 15px; font-weight: 700; color: #fff; line-height: 1; letter-spacing: -0.3px;
}
.brand-sub { font-size: 10px; color: var(--text-dim); font-weight: 400; margin-top: 2px; }

.btn-home {
  padding: 8px 16px; font-size: 12px; font-weight: 600; font-family: "Sarabun", sans-serif;
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2); border-radius: var(--radius-sm); cursor: pointer;
  display: flex; align-items: center; gap: 6px;
  transition: background 0.2s, color 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.btn-home:hover { background: var(--surface-3); color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap {
  position: relative; z-index: 1;
  max-width: 960px; margin: 0 auto;
  padding: 24px 16px 100px; /* Padding bottom allows space for nav */
  width: 100%; display: flex; flex-direction: column; gap: 16px;
}

.page-title-row {
  display: flex; align-items: center; gap: 10px; margin-bottom: 4px;
  animation: slideUp 0.4s ease both;
}
.page-title {
  font-family: "Outfit", sans-serif;
  font-size: 20px; font-weight: 800; color: #fff; letter-spacing: -0.5px;
}
.page-sub { font-size: 12px; color: var(--text-dim); }

/* â”€â”€â”€ Section Title â”€â”€â”€ */
.section-title {
  font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--text-faint); margin-bottom: 10px;
  display: flex; align-items: center; gap: 8px;
}
.section-title::after { content: ""; flex: 1; height: 1px; background: var(--border); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  animation: slideUp 0.4s ease both;
}
.card:nth-child(1) { animation-delay: 0.05s; }
.card:nth-child(2) { animation-delay: 0.10s; }
.card:nth-child(3) { animation-delay: 0.15s; }

.card-header {
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
  background: var(--surface-2);
}
.card-header-icon {
  width: 32px; height: 32px; border-radius: 8px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0;
  box-shadow: 0 0 12px var(--teal-glow);
}
.card-header h4 { font-size: 14px; font-weight: 700; color: #fff; margin: 0; }
.card-header-sub { font-size: 11px; color: var(--text-dim); margin-left: auto; }

.card-body { padding: 18px; }
.card-footer {
  padding: 12px 18px;
  border-top: 1px solid var(--border);
  background: var(--surface-2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM FIELDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.field-group { display: flex; flex-direction: column; gap: 5px; }
.field-label { font-size: 11px; font-weight: 600; color: var(--text-dim); letter-spacing: 0.5px; text-transform: uppercase; }

input, select, textarea {
  width: 100%; padding: 10px 12px;
  font-size: 14px; font-family: "Sarabun", sans-serif;
  background: var(--surface-2);
  border: 1px solid var(--border-2);
  border-radius: var(--radius-sm);
  color: var(--text); outline: none;
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
  -webkit-appearance: none;
}
input::placeholder { color: var(--text-faint); }
input:focus, select:focus, textarea:focus {
  border-color: var(--teal);
  box-shadow: 0 0 0 3px var(--teal-glow);
  background: rgba(255,255,255,0.08);
}
select { cursor: pointer; }
select option { background: var(--navy-mid); color: var(--text); }
textarea { resize: vertical; min-height: 60px; line-height: 1.5; }

/* Owner row */
.owner-row {
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 12px; align-items: end;
}
@media (max-width: 560px) {
  .owner-row { grid-template-columns: 1fr; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  padding: 10px 16px; font-size: 13px; font-weight: 600; font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  display: inline-flex; align-items: center; gap: 6px;
  transition: opacity 0.2s, transform 0.15s;
  -webkit-tap-highlight-color: transparent;
  white-space: nowrap;
}
.btn:active { transform: scale(0.96); }
.btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none !important; }

.btn-ghost {
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2);
}
.btn-ghost:hover { background: var(--surface-3); color: var(--text); }

.btn-paste {
  background: var(--emerald-soft); color: var(--emerald);
  border: 1px solid rgba(16,185,129,0.3);
}
.btn-paste:hover { background: rgba(16,185,129,0.22); }

.btn-add {
  background: var(--surface-3); color: var(--text);
  border: 1px solid var(--border-2);
}
.btn-add:hover { background: rgba(14,165,160,0.12); border-color: var(--teal); color: var(--teal-light); }

.btn-del {
  padding: 7px 10px; font-size: 14px;
  background: var(--rose-soft); color: var(--rose);
  border: 1px solid rgba(239,68,68,0.3);
}
.btn-del:hover { background: rgba(239,68,68,0.22); }

.btn-submit {
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  color: #fff; font-size: 15px; padding: 14px 36px;
  border-radius: var(--radius); width: 100%; justify-content: center;
  box-shadow: 0 4px 24px var(--teal-glow);
  letter-spacing: 0.3px;
}
.btn-submit:hover { opacity: 0.9; box-shadow: 0 6px 30px var(--teal-glow); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMAL CARDS (mobile-first, card per row)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#animalList { display: flex; flex-direction: column; gap: 12px; }

.animal-card {
  background: var(--surface-2);
  border: 1px solid var(--border-2);
  border-radius: var(--radius);
  padding: 16px;
  position: relative;
  animation: slideUp 0.3s ease both;
  transition: border-color 0.2s;
}
.animal-card:hover { border-color: rgba(14,165,160,0.3); }

.animal-card-header {
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 14px;
}
.animal-card-num {
  width: 28px; height: 28px; border-radius: 50%;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: #fff; flex-shrink: 0;
  font-family: "Outfit", sans-serif;
}
.animal-card-label {
  font-size: 13px; font-weight: 600; color: var(--text); flex: 1;
}

/* animal fields grid */
.animal-fields {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 80px;
  gap: 10px;
  margin-bottom: 14px;
}
@media (max-width: 560px) {
  .animal-fields { grid-template-columns: 1fr 1fr; }
}

/* service checkboxes */
.svc-section { margin-bottom: 12px; }
.svc-label-row {
  font-size: 10px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  color: var(--text-faint); margin-bottom: 8px;
}
.svc-grid {
  display: flex; flex-wrap: wrap; gap: 7px;
}
.svc-chip {
  display: flex; align-items: center; gap: 6px;
  cursor: pointer; font-size: 12px; font-weight: 500;
  background: var(--surface); border: 1px solid var(--border-2);
  color: var(--text-dim); border-radius: 20px;
  padding: 6px 12px;
  user-select: none;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.svc-chip:hover { background: var(--surface-3); border-color: var(--teal); color: var(--text); }
.svc-chip input[type="checkbox"] { display: none; }
.svc-chip.checked {
  background: rgba(14,165,160,0.15);
  border-color: var(--teal);
  color: var(--teal-light);
  font-weight: 600;
}
.svc-chip.checked::before { content: "âœ“ "; font-size: 11px; }

/* health note */
.note-section { }
.note-section textarea {
  font-size: 13px; min-height: 52px;
}
.note-section textarea.has-content {
  border-color: var(--amber);
  background: rgba(245,158,11,0.06);
  color: var(--amber);
}
.note-section textarea.has-content::placeholder { color: rgba(245,158,11,0.4); }

/* delete btn position */
.btn-del-animal {
  position: absolute; top: 12px; right: 12px;
}

/* Empty state */
.empty-state {
  text-align: center; padding: 32px 16px;
  color: var(--text-faint);
}
.empty-state-icon { font-size: 40px; margin-bottom: 10px; }
.empty-state-text { font-size: 13px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.submit-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 18px;
  animation: slideUp 0.4s 0.2s ease both;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE BOTTOM NAV (â‰¤ 640px)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
  background: rgba(11,25,41,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border-2);
  padding: 8px 0 max(8px, env(safe-area-inset-bottom));
  grid-template-columns: repeat(5, 1fr);
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 6px 4px;
  font-size: 9px; color: var(--text-dim);
  text-decoration: none; cursor: pointer;
  transition: color 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.nav-item:active { color: var(--teal); }
.nav-icon { font-size: 21px; line-height: 1; }
.nav-item.active { color: var(--teal); }
.nav-item.active .nav-icon { filter: drop-shadow(0 0 6px var(--teal)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#printArea { display: none; }
@media print {
  body > :not(#printArea) { display: none !important; }
  #printArea { display: block !important; }
  .sticker-page {
    position: relative; width: 80mm; height: 50mm;
    page-break-after: always; overflow: hidden; background: #fff;
  }
  .line {
    position: absolute; white-space: pre-wrap; word-break: break-word;
    box-sizing: border-box; padding-right: 5px; color: #000 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  @page { size: 80mm 50mm; margin: 0; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE TWEAKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 640px) {
  header { height: 56px; padding: 0 14px; }
  .brand-sub { display: none; }
  .brand-name { font-size: 14px; }
  .wrap { padding: 18px 12px 90px; } /* Increased bottom padding for nav */
  .page-title { font-size: 18px; }
  .card-body { padding: 14px; }
  .card-footer { padding: 10px 14px; }
  .bottom-nav { display: grid; }
}
</style>
</head>
<body>

<div class="font-preload">
  <span style="font-family:'Kanit',sans-serif;">à¹‚à¸«à¸¥à¸”</span>
  <span style="font-family:'Prompt',sans-serif;">à¹‚à¸«à¸¥à¸”</span>
  <span style="font-family:'Sarabun',sans-serif;">à¹‚à¸«à¸¥à¸”</span>
</div>

<header>
  <div class="brand">
    <div class="brand-logo">ğŸ“</div>
    <div>
      <div class="brand-name">à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸±à¸•à¸§à¹Œ</div>
      <div class="brand-sub">RMUTTO â€“ Veterinary Academic Service Division</div>
    </div>
  </div>
  <button class="btn-home" onclick="location.href='index.html'">ğŸ  à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸</button>
</header>

<div class="wrap">

  <div class="page-title-row">
    <div>
      <div class="page-title">à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸±à¸•à¸§à¹Œà¹€à¸‚à¹‰à¸²à¸£à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£</div>
      <div class="page-sub">à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¹à¸¥à¸°à¸ªà¸±à¸•à¸§à¹Œà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸£à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-header-icon">ğŸ‘¤</div>
      <h4>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸ªà¸±à¸•à¸§à¹Œ</h4>
    </div>
    <div class="card-body">
      <div class="owner-row">
        <div class="field-group">
          <label class="field-label">à¸Šà¸·à¹ˆà¸­à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡ *</label>
          <input id="ownerName" placeholder="à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥" required>
        </div>
        <div class="field-group">
          <label class="field-label">à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£</label>
          <input id="phone" type="tel" placeholder="08x-xxx-xxxx">
        </div>
        <div class="field-group">
          <label class="field-label" style="opacity:0">à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­</label>
          <button type="button" class="btn btn-paste" onclick="window.pasteOwnerName()">ğŸ“‹ à¸§à¸²à¸‡à¸ˆà¸²à¸à¸„à¸¥à¸´à¸›à¸šà¸­à¸£à¹Œà¸”</button>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-header-icon">ğŸ¾</div>
      <h4>à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œ</h4>
      <span class="card-header-sub" id="animalCount">0 à¸£à¸²à¸¢à¸à¸²à¸£</span>
    </div>
    <div class="card-body">
      <div id="animalList">
        <div class="empty-state" id="emptyState">
          <div class="empty-state-icon">ğŸ¾</div>
          <div class="empty-state-text">à¸à¸” "à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œ" à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</div>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <button type="button" class="btn btn-add" onclick="window.addAnimal()">â• à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¸•à¸§à¹Œ</button>
    </div>
  </div>

  <div class="submit-card">
    <button type="button" id="btnSaveAll" class="btn btn-submit" onclick="window.saveAll()">
      ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š à¹à¸¥à¸°à¸à¸´à¸¡à¸à¹Œà¸„à¸´à¸§
    </button>
  </div>

</div>

<nav class="bottom-nav">
  <a class="nav-item" href="index.html">
    <span class="nav-icon">ğŸ </span>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸
  </a>
  <a class="nav-item" href="animals.html">
    <span class="nav-icon">ğŸ¾</span>à¸ªà¸±à¸•à¸§à¹Œ
  </a>
  <a class="nav-item" href="anesthesia.html">
    <span class="nav-icon">ğŸ©º</span>à¸§à¸²à¸‡à¸¢à¸²
  </a>
  <a class="nav-item" href="surgery.html">
    <span class="nav-icon">ğŸ“‹</span>à¸œà¹ˆà¸²à¸•à¸±à¸”
  </a>
  <a class="nav-item" href="recovery.html">
    <span class="nav-icon">ğŸ›ï¸</span>à¸à¸±à¸à¸Ÿà¸·à¹‰à¸™
  </a>
</nav>

<div id="printArea"></div>

<script type="module">
import { supabase } from "./js/supabase.js";

let animalCount = 0;

/* â”€â”€ Count display â”€â”€ */
function refreshCount() {
  const rows = document.querySelectorAll(".animal-card");
  document.getElementById("animalCount").textContent = `${rows.length} à¸£à¸²à¸¢à¸à¸²à¸£`;
  document.getElementById("emptyState").style.display = rows.length === 0 ? "block" : "none";
  /* re-number badges */
  rows.forEach((card, i) => {
    const num = card.querySelector(".animal-card-num");
    if (num) num.textContent = i + 1;
    const lbl = card.querySelector(".animal-card-label");
    if (lbl) lbl.textContent = `à¸ªà¸±à¸•à¸§à¹Œà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆ ${i + 1}`;
  });
}

/* â”€â”€ Paste owner name â”€â”€ */
window.pasteOwnerName = async function () {
  try {
    const text = await navigator.clipboard.readText();
    if (!text) return alert("âš ï¸ à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™ Clipboard");
    document.getElementById("ownerName").value = text.trim();
    document.getElementById("phone").focus();
  } catch { alert("âš ï¸ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸­à¹ˆà¸²à¸™ Clipboard à¹„à¸”à¹‰"); }
};

/* â”€â”€ Phone format â”€â”€ */
document.getElementById("phone").addEventListener("input", function () {
  let v = this.value.replace(/\D/g, "").slice(0, 10);
  if (v.length > 6)      v = v.replace(/(\d{3})(\d{3})(\d+)/, "$1-$2-$3");
  else if (v.length > 3) v = v.replace(/(\d{3})(\d+)/, "$1-$2");
  this.value = v;
});

/* â”€â”€ Build service chips â”€â”€ */
function buildSvcChips(container, sex, species) {
  const neuter = sex === "à¸œà¸¹à¹‰" ? "à¸—à¸³à¸«à¸¡à¸±à¸™à¹€à¸à¸¨à¸œà¸¹à¹‰" : "à¸—à¸³à¸«à¸¡à¸±à¸™à¹€à¸à¸¨à¹€à¸¡à¸µà¸¢";
  const services = [
    neuter,
    "à¸‰à¸µà¸”à¸§à¸±à¸„à¸‹à¸µà¸™à¸à¸´à¸©à¸ªà¸¸à¸™à¸±à¸‚à¸šà¹‰à¸²",
    ...(species === "à¸ª" ? ["à¸‰à¸µà¸”à¸¢à¸²à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¹€à¸«à¹‡à¸š"] : []),
    "à¸•à¸£à¸§à¸ˆà¹€à¸¥à¸·à¸­à¸”",
    "à¸à¸±à¸‡à¹„à¸¡à¹‚à¸„à¸£à¸Šà¸´à¸Ÿ",
  ];
  container.innerHTML = "";
  services.forEach((svc, idx) => {
    const lbl = document.createElement("label");
    lbl.className = "svc-chip" + (idx === 0 ? " checked" : "");
    lbl.dataset.value = svc;
    lbl.innerHTML = `<input type="checkbox" class="svc" value="${svc}" ${idx === 0 ? "checked" : ""}>${svc}`;
    lbl.addEventListener("click", (e) => {
      e.preventDefault();
      const cb = lbl.querySelector("input");
      cb.checked = !cb.checked;
      lbl.classList.toggle("checked", cb.checked);
    });
    container.appendChild(lbl);
  });
}

/* â”€â”€ Add animal card â”€â”€ */
window.addAnimal = function () {
  animalCount++;
  const card = document.createElement("div");
  card.className = "animal-card";
  card.innerHTML = `
    <div class="animal-card-header">
      <div class="animal-card-num">${animalCount}</div>
      <span class="animal-card-label">à¸ªà¸±à¸•à¸§à¹Œà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆ ${animalCount}</span>
    </div>
    <button type="button" class="btn btn-del btn-del-animal" onclick="this.closest('.animal-card').remove(); refreshCount();">ğŸ—‘</button>

    <div class="animal-fields">
      <div class="field-group">
        <label class="field-label">à¸Šà¸·à¹ˆà¸­à¸ªà¸±à¸•à¸§à¹Œ *</label>
        <input class="animalName" placeholder="à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­..." required>
      </div>
      <div class="field-group">
        <label class="field-label">à¸Šà¸™à¸´à¸”</label>
        <select class="species">
          <option value="à¸¡">ğŸ± à¹à¸¡à¸§</option>
          <option value="à¸ª">ğŸ¶ à¸ªà¸¸à¸™à¸±à¸‚</option>
        </select>
      </div>
      <div class="field-group">
        <label class="field-label">à¹€à¸à¸¨</label>
        <select class="sex">
          <option value="à¹€à¸¡à¸µà¸¢">â™€ à¹€à¸¡à¸µà¸¢</option>
          <option value="à¸œà¸¹à¹‰">â™‚ à¸œà¸¹à¹‰</option>
        </select>
      </div>
      <div class="field-group">
        <label class="field-label">à¸™à¸™. (à¸à¸.)</label>
        <input type="number" class="estWeight" value="3" min="0" step="0.1">
      </div>
    </div>

    <div class="svc-section">
      <div class="svc-label-row">à¸šà¸£à¸´à¸à¸²à¸£à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£</div>
      <div class="svc-grid"></div>
    </div>

    <div class="note-section">
      <div class="field-group">
        <label class="field-label">âš ï¸ à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸¸à¸‚à¸ à¸²à¸ / à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡</label>
        <textarea class="healthNote" placeholder="à¹‚à¸£à¸„à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§, à¸¢à¸²à¸—à¸µà¹ˆà¹à¸à¹‰, à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡..."></textarea>
      </div>
    </div>
  `;

  const svcGrid  = card.querySelector(".svc-grid");
  const species  = card.querySelector(".species");
  const sex      = card.querySelector(".sex");
  const note     = card.querySelector(".healthNote");
  const nameInput= card.querySelector(".animalName");

  nameInput.addEventListener("input", () => { nameInput.style.borderColor = ""; });

  function refreshSvc() { buildSvcChips(svcGrid, sex.value, species.value); }
  refreshSvc();
  species.addEventListener("change", refreshSvc);
  sex.addEventListener("change", refreshSvc);
  note.addEventListener("input", () => note.classList.toggle("has-content", note.value.trim() !== ""));

  /* expose refreshCount globally so inline onclick works */
  window.refreshCount = refreshCount;

  const list = document.getElementById("animalList");
  list.appendChild(card);
  refreshCount();
  card.scrollIntoView({ behavior: "smooth", block: "nearest" });
};

/* â”€â”€ Save All â”€â”€ */
window.saveAll = async function () {
  const btnSave = document.getElementById("btnSaveAll");
  const ownerNameInput = document.getElementById("ownerName");
  const ownerName = ownerNameInput.value.trim();
  const phone     = document.getElementById("phone").value.trim();

  if (!ownerName) { alert("âŒ à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸ªà¸±à¸•à¸§à¹Œ"); ownerNameInput.focus(); return; }
  const cards = document.querySelectorAll(".animal-card");
  if (cards.length === 0) return alert("âŒ à¸à¸£à¸¸à¸“à¸²à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸±à¸•à¸§à¹Œà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸£à¸²à¸¢à¸à¸²à¸£");

  let hasError = false;
  cards.forEach((card, i) => {
    const ni = card.querySelector(".animalName");
    if (!ni.value.trim()) {
      alert(`âŒ à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸ªà¸±à¸•à¸§à¹Œà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆ ${i + 1}`);
      ni.focus(); ni.style.borderColor = "var(--rose)"; hasError = true;
    }
  });
  if (hasError) return;

  btnSave.disabled = true; btnSave.textContent = "â³ à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...";

  try {
    const { data: eventId, error: evtErr } = await supabase.rpc("get_today_event");
    if (evtErr) throw evtErr;

    const { data: owner, error: ownerErr } = await supabase
      .from("vasd_owner")
      .insert({ event_id: eventId, owner_name: ownerName, phone })
      .select().single();
    if (ownerErr) throw ownerErr;

    const { count, error: cntErr } = await supabase
      .from("vasd_animal").select("*", { count: "exact", head: true }).eq("event_id", eventId);
    if (cntErr) throw cntErr;

    let q = (count || 0) + 1, svcs = [], queues = [], forPrint = [];

    for (const card of cards) {
      const spVal = card.querySelector(".species").value;
      const { data: animal, error: animalErr } = await supabase
        .from("vasd_animal").insert({
          event_id: eventId, owner_id: owner.id, queue_number: q++,
          species: spVal,
          animal_name: card.querySelector(".animalName").value.trim(),
          sex: card.querySelector(".sex").value,
          est_weight: card.querySelector(".estWeight").value || 0,
          health_note: card.querySelector(".healthNote").value.trim()
        }).select().single();
      if (animalErr) throw animalErr;

      let sNames = [];
      card.querySelectorAll(".svc:checked").forEach(s => {
        svcs.push({ animal_id: animal.id, service_type: s.value });
        sNames.push(s.value);
      });
      queues.push({ animal_id: animal.id, status: "waiting" });
      forPrint.push({ q: animal.queue_number, name: animal.animal_name, spc: spVal === "à¸¡" ? "à¹à¸¡à¸§" : "à¸ªà¸¸à¸™à¸±à¸‚", sex: animal.sex, svc: sNames.join(", ") });
    }

    if (svcs.length)   await supabase.from("vasd_service").insert(svcs);
    if (queues.length) await supabase.from("vasd_queue").insert(queues);

    const { data: tmplData } = await supabase.from("vasd_print_template").select("config").eq("template_type", "queue").single();
    if (tmplData?.config) {
      let html = "";
      forPrint.forEach(a => {
        let page = "<div class='sticker-page'>";
        tmplData.config.forEach(l => {
          let txt = l.text
            .replace("{{queue_number}}", a.q).replace("{{animal_name}}", a.name)
            .replace("{{species}}", a.spc).replace("{{sex}}", a.sex)
            .replace("{{owner_name}}", ownerName).replace("{{phone}}", phone || "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸")
            .replace("{{services}}", a.svc);
          let fnt = (l.font || "'Segoe UI'").replace(/"/g, "'");
          page += `<div class="line" style="left:${l.x||0}px;width:calc(100% - ${l.x||0}px);top:${l.y||0}px;font-size:${l.size}px;font-weight:${l.weight};font-family:${fnt};text-align:${l.align||"left"};">${txt}</div>`;
        });
        html += page + "</div>";
      });
      document.getElementById("printArea").innerHTML = html;
      try {
        await document.fonts.load("16px 'Kanit'");
        await document.fonts.load("16px 'Prompt'");
        await document.fonts.load("16px 'Sarabun'");
      } catch(e) {}
      await document.fonts.ready;
      await new Promise(r => setTimeout(r, 300));
      window.print();
    }

    setTimeout(() => { location.href = "index.html"; }, 1000);

  } catch (err) {
    console.error(err);
    alert("âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: " + (err.message || "à¹‚à¸›à¸£à¸”à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"));
    btnSave.disabled = false;
    btnSave.innerHTML = "ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š à¹à¸¥à¸°à¸à¸´à¸¡à¸à¹Œà¸„à¸´à¸§";
  }
};

/* auto-add first animal */
window.addAnimal();
</script>
</body>
</html>
