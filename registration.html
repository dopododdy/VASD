<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå ‚Äì VASD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&family=Kanit:wght@300;400;500;700&family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESIGN TOKENS (matches index.html)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  --navy:       #0b1929;
  --navy-mid:   #112240;
  --navy-card:  #162d4a;
  --teal:       #0ea5a0;
  --teal-light: #14c4bc;
  --teal-glow:  rgba(14,165,160,0.25);
  --amber:      #f59e0b;
  --rose:       #ef4444;
  --rose-soft:  rgba(239,68,68,0.15);
  --emerald:    #10b981;
  --emerald-soft: rgba(16,185,129,0.15);
  --violet:     #8b5cf6;

  --surface:    rgba(255,255,255,0.04);
  --surface-2:  rgba(255,255,255,0.07);
  --surface-3:  rgba(255,255,255,0.10);
  --border:     rgba(255,255,255,0.08);
  --border-2:   rgba(255,255,255,0.14);
  --text:       #e2e8f0;
  --text-dim:   #94a3b8;
  --text-faint: #4a5568;

  --radius-xs:  6px;
  --radius-sm:  10px;
  --radius:     16px;
  --radius-lg:  22px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: "Sarabun", sans-serif;
  background: var(--navy);
  color: var(--text);
  min-height: 100vh; min-height: 100dvh;
  display: flex; flex-direction: column;
  overflow-x: hidden;
}

/* Mesh background */
body::before {
  content: ""; position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(14,165,160,0.10) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 80% 80%, rgba(99,102,241,0.07) 0%, transparent 60%);
}

/* Font preload */
.font-preload { position: absolute; opacity: 0; pointer-events: none; z-index: -9999; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HEADER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(11,25,41,0.88);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  height: 64px;
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
}

.brand { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.brand-logo {
  width: 38px; height: 38px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center; font-size: 18px;
  box-shadow: 0 0 20px var(--teal-glow);
}
.brand-name {
  font-family: "Outfit", sans-serif;
  font-size: 15px; font-weight: 700; color: #fff; line-height: 1; letter-spacing: -0.3px;
}
.brand-sub { font-size: 10px; color: var(--text-dim); font-weight: 400; margin-top: 2px; }

.btn-home {
  padding: 8px 16px; font-size: 12px; font-weight: 600; font-family: "Sarabun", sans-serif;
  background: var(--surface-2); color: var(--text-dim);
  border: 1px solid var(--border-2); border-radius: var(--radius-sm); cursor: pointer;
  display: flex; align-items: center; gap: 6px;
  transition: background 0.2s, color 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.btn-home:hover { background: var(--surface-3); color: var(--text); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LAYOUT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.wrap {
  position: relative; z-index: 1;
  max-width: 960px; margin: 0 auto;
  padding: 24px 16px 100px;
  width: 100%; display: flex; flex-direction: column; gap: 16px;
}

.page-title-row {
  display: flex; align-items: center; gap: 10px; margin-bottom: 4px;
  animation: slideUp 0.4s ease both;
}
.page-title {
  font-family: "Outfit", sans-serif;
  font-size: 20px; font-weight: 800; color: #fff; letter-spacing: -0.5px;
}
.page-sub { font-size: 12px; color: var(--text-dim); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  animation: slideUp 0.4s ease both;
}
.card:nth-child(1) { animation-delay: 0.05s; }
.card:nth-child(2) { animation-delay: 0.10s; }
.card:nth-child(3) { animation-delay: 0.15s; }

.card-header {
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
  background: var(--surface-2);
}
.card-header-icon {
  width: 32px; height: 32px; border-radius: 8px;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0;
  box-shadow: 0 0 12px var(--teal-glow);
}
.card-header h4 { font-size: 14px; font-weight: 700; color: #fff; margin: 0; }
.card-header-sub { font-size: 11px; color: var(--text-dim); margin-left: auto; }

.card-body { padding: 18px; }
.card-footer {
  padding: 12px 18px;
  border-top: 1px solid var(--border);
  background: var(--surface-2);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FORM FIELDS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.field-group { display: flex; flex-direction: column; gap: 5px; }
.field-label { font-size: 11px; font-weight: 600; color: var(--text-dim); letter-spacing: 0.5px; text-transform: uppercase; }

input, select, textarea {
  width: 100%; padding: 10px 12px;
  font-size: 14px; font-family: "Sarabun", sans-serif;
  background: var(--surface-2);
  border: 1px solid var(--border-2);
  border-radius: var(--radius-sm);
  color: var(--text); outline: none;
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
  -webkit-appearance: none;
}
input::placeholder { color: var(--text-faint); }
input:focus, select:focus, textarea:focus {
  border-color: var(--teal);
  box-shadow: 0 0 0 3px var(--teal-glow);
  background: rgba(255,255,255,0.08);
}
select { cursor: pointer; }
select option { background: var(--navy-mid); color: var(--text); }
textarea { resize: vertical; min-height: 60px; line-height: 1.5; }

.owner-row {
  display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: end; margin-bottom: 12px;
}
.owner-row-2 {
  display: grid; grid-template-columns: 1fr 2fr; gap: 12px; align-items: end;
}
@media (max-width: 560px) {
  .owner-row { grid-template-columns: 1fr; margin-bottom: 0; gap: 12px; }
  .owner-row-2 { grid-template-columns: 1fr; margin-top: 12px; }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BUTTONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.btn {
  padding: 10px 16px; font-size: 13px; font-weight: 600; font-family: "Sarabun", sans-serif;
  border: none; border-radius: var(--radius-sm); cursor: pointer;
  display: inline-flex; align-items: center; gap: 6px;
  transition: opacity 0.2s, transform 0.15s, background 0.3s;
  -webkit-tap-highlight-color: transparent; white-space: nowrap;
}
.btn:active { transform: scale(0.96); }
.btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

.btn-paste { background: var(--emerald-soft); color: var(--emerald); border: 1px solid rgba(16,185,129,0.3); }
.btn-paste:hover { background: rgba(16,185,129,0.22); }
.btn-add { background: var(--surface-3); color: var(--text); border: 1px solid var(--border-2); }
.btn-add:hover { background: rgba(14,165,160,0.12); border-color: var(--teal); color: var(--teal-light); }
.btn-del { padding: 7px 10px; font-size: 14px; background: var(--rose-soft); color: var(--rose); border: 1px solid rgba(239,68,68,0.3); }
.btn-del:hover { background: rgba(239,68,68,0.22); }

.btn-submit {
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  color: #fff; font-size: 15px; padding: 14px 36px;
  border-radius: var(--radius); width: 100%; justify-content: center;
  box-shadow: 0 4px 24px var(--teal-glow); letter-spacing: 0.3px;
}
.btn-submit:hover:not(:disabled) { opacity: 0.9; box-shadow: 0 6px 30px var(--teal-glow); }

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≠‡∏ô‡∏£‡∏≠ Consent */
.btn-submit.waiting {
  background: linear-gradient(135deg, var(--amber), #fbbf24);
  box-shadow: 0 4px 24px rgba(245, 158, 11, 0.3);
  animation: pulse-amber 1.5s infinite alternate;
}
@keyframes pulse-amber {
  from { opacity: 0.8; box-shadow: 0 0 10px rgba(245, 158, 11, 0.4); }
  to { opacity: 1; box-shadow: 0 0 25px rgba(245, 158, 11, 0.8); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ANIMAL CARDS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#animalList { display: flex; flex-direction: column; gap: 12px; }
.animal-card {
  background: var(--surface-2); border: 1px solid var(--border-2);
  border-radius: var(--radius); padding: 16px; position: relative;
  animation: slideUp 0.3s ease both; transition: border-color 0.2s;
}
.animal-card:hover { border-color: rgba(14,165,160,0.3); }
.animal-card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 14px; }
.animal-card-num {
  width: 28px; height: 28px; border-radius: 50%;
  background: linear-gradient(135deg, var(--teal), var(--teal-light));
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: #fff; flex-shrink: 0;
  font-family: "Outfit", sans-serif;
}
.animal-card-label { font-size: 13px; font-weight: 600; color: var(--text); flex: 1; }

.animal-fields { display: grid; grid-template-columns: 1fr 1fr 1fr 80px; gap: 10px; margin-bottom: 14px; }
@media (max-width: 560px) { .animal-fields { grid-template-columns: 1fr 1fr; } }

.svc-section { margin-bottom: 12px; }
.svc-label-row { font-size: 10px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--text-faint); margin-bottom: 8px; }
.svc-grid { display: flex; flex-wrap: wrap; gap: 7px; }
.svc-chip {
  display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px; font-weight: 500;
  background: var(--surface); border: 1px solid var(--border-2); color: var(--text-dim);
  border-radius: 20px; padding: 6px 12px; user-select: none; transition: all 0.2s; -webkit-tap-highlight-color: transparent;
}
.svc-chip:hover { background: var(--surface-3); border-color: var(--teal); color: var(--text); }
.svc-chip input[type="checkbox"] { display: none; }
.svc-chip.checked { background: rgba(14,165,160,0.15); border-color: var(--teal); color: var(--teal-light); font-weight: 600; }
.svc-chip.checked::before { content: "‚úì "; font-size: 11px; }

.note-section textarea { font-size: 13px; min-height: 52px; }
.note-section textarea.has-content { border-color: var(--amber); background: rgba(245,158,11,0.06); color: var(--amber); }
.note-section textarea.has-content::placeholder { color: rgba(245,158,11,0.4); }

.btn-del-animal { position: absolute; top: 12px; right: 12px; }

.empty-state { text-align: center; padding: 32px 16px; color: var(--text-faint); }
.empty-state-icon { font-size: 40px; margin-bottom: 10px; }
.empty-state-text { font-size: 13px; }

.submit-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 18px; animation: slideUp 0.4s 0.2s ease both; }

.bottom-nav {
  display: none; position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
  background: rgba(11,25,41,0.95); backdrop-filter: blur(20px); border-top: 1px solid var(--border-2);
  padding: 8px 0 max(8px, env(safe-area-inset-bottom)); grid-template-columns: repeat(5, 1fr);
}
.nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 6px 4px; font-size: 9px; color: var(--text-dim); text-decoration: none; }
.nav-item.active { color: var(--teal); }
.nav-item.active .nav-icon { filter: drop-shadow(0 0 6px var(--teal)); }

#printArea { display: none; }
@media print {
  body > :not(#printArea) { display: none !important; }
  #printArea { display: block !important; }
  .sticker-page { position: relative; width: 80mm; height: 50mm; page-break-after: always; overflow: hidden; background: #fff; }
  .line { position: absolute; white-space: pre-wrap; word-break: break-word; box-sizing: border-box; padding-right: 5px; color: #000 !important; }
  @page { size: 80mm 50mm; margin: 0; }
}

@keyframes slideUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

@media (max-width: 640px) {
  header { height: 56px; padding: 0 14px; }
  .brand-sub { display: none; }
  .brand-name { font-size: 14px; }
  .wrap { padding: 18px 12px 90px; }
  .page-title { font-size: 18px; }
  .card-body { padding: 14px; }
  .card-footer { padding: 10px 14px; }
  .bottom-nav { display: grid; }
}
</style>
</head>
<body>

<div class="font-preload">
  <span style="font-family:'Kanit',sans-serif;">‡πÇ‡∏´‡∏•‡∏î</span>
  <span style="font-family:'Prompt',sans-serif;">‡πÇ‡∏´‡∏•‡∏î</span>
  <span style="font-family:'Sarabun',sans-serif;">‡πÇ‡∏´‡∏•‡∏î</span>
</div>

<header>
  <div class="brand">
    <div class="brand-logo">üìù</div>
    <div>
      <div class="brand-name">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå</div>
      <div class="brand-sub">RMUTTO ‚Äì Veterinary Academic Service Division</div>
    </div>
  </div>
  <button class="btn-home" onclick="location.href='index.html'">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
</header>

<div class="wrap">

  <div class="page-title-row">
    <div>
      <div class="page-title">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>
      <div class="page-sub">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (Consent)</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-header-icon">üë§</div>
      <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå</h4>
    </div>
    <div class="card-body">
      <div class="owner-row">
        <div class="field-group">
          <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á *</label>
          <input id="ownerName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
        </div>
        <div class="field-group">
          <label class="field-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input id="phone" type="tel" placeholder="08x-xxx-xxxx">
        </div>
        <div class="field-group">
          <label class="field-label" style="opacity:0">‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠</label>
          <button type="button" class="btn btn-paste" onclick="window.pasteOwnerName()">üìã ‡∏ß‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
        </div>
      </div>
      <div class="owner-row-2">
        <div class="field-group">
          <label class="field-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
          <input id="idCard" type="text" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å" maxlength="13">
        </div>
        <div class="field-group">
          <label class="field-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
          <input id="address" type="text" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏´‡∏°‡∏π‡πà, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-header-icon">üêæ</div>
      <h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå</h4>
      <span class="card-header-sub" id="animalCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
    </div>
    <div class="card-body">
      <div id="animalList">
        <div class="empty-state" id="emptyState">
          <div class="empty-state-icon">üêæ</div>
          <div class="empty-state-text">‡∏Å‡∏î "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <button type="button" class="btn btn-add" onclick="window.addAnimal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå</button>
    </div>
  </div>

  <div class="submit-card">
    <button type="button" id="btnRequestConsent" class="btn btn-submit" onclick="window.requestConsent()">
      üì≤ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ Consent ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ iPad
    </button>
  </div>

</div>

<nav class="bottom-nav">
  <a class="nav-item active" href="registration.html"><span class="nav-icon">üìù</span>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</a>
  <a class="nav-item" href="animals.html"><span class="nav-icon">üêæ</span>‡∏™‡∏±‡∏ï‡∏ß‡πå</a>
  <a class="nav-item" href="anesthesia.html"><span class="nav-icon">ü©∫</span>‡∏ß‡∏≤‡∏á‡∏¢‡∏≤</a>
  <a class="nav-item" href="surgery.html"><span class="nav-icon">üìã</span>‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</a>
  <a class="nav-item" href="recovery.html"><span class="nav-icon">üõèÔ∏è</span>‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</a>
</nav>

<div id="printArea"></div>

<script type="module">
import { supabase } from "./js/supabase.js";

let animalCount = 0;
let isWaitingForConsent = false;

/* ‚îÄ‚îÄ SETTING UP SUPABASE REALTIME (BROADCAST) ‚îÄ‚îÄ */
// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡∏∑‡πà‡∏≠ vasd-consent-room ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö iPad
const consentChannel = supabase.channel('vasd-consent-room');

// ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì 'consent-granted' ‡∏à‡∏≤‡∏Å iPad
consentChannel
  .on('broadcast', { event: 'consent-granted' }, (payload) => {
    if (isWaitingForConsent) {
      console.log("‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
      executeSave(); // ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    }
  })
  .subscribe();

/* ‚îÄ‚îÄ Count display ‚îÄ‚îÄ */
function refreshCount() {
  const rows = document.querySelectorAll(".animal-card");
  document.getElementById("animalCount").textContent = `${rows.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
  document.getElementById("emptyState").style.display = rows.length === 0 ? "block" : "none";
  rows.forEach((card, i) => {
    const num = card.querySelector(".animal-card-num");
    if (num) num.textContent = i + 1;
    const lbl = card.querySelector(".animal-card-label");
    if (lbl) lbl.textContent = `‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`;
  });
}

/* ‚îÄ‚îÄ Paste owner name ‚îÄ‚îÄ */
window.pasteOwnerName = async function () {
  try {
    const text = await navigator.clipboard.readText();
    if (!text) return alert("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Clipboard");
    document.getElementById("ownerName").value = text.trim();
    document.getElementById("phone").focus();
  } catch { alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô Clipboard ‡πÑ‡∏î‡πâ"); }
};

/* ‚îÄ‚îÄ Phone format ‚îÄ‚îÄ */
document.getElementById("phone").addEventListener("input", function () {
  let v = this.value.replace(/\D/g, "").slice(0, 10);
  if (v.length > 6)      v = v.replace(/(\d{3})(\d{3})(\d+)/, "$1-$2-$3");
  else if (v.length > 3) v = v.replace(/(\d{3})(\d+)/, "$1-$2");
  this.value = v;
});

/* ‚îÄ‚îÄ Build service chips ‚îÄ‚îÄ */
function buildSvcChips(container, sex, species) {
  const neuter = sex === "‡∏ú‡∏π‡πâ" ? "‡∏ó‡∏≥‡∏´‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏®‡∏ú‡∏π‡πâ" : "‡∏ó‡∏≥‡∏´‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏®‡πÄ‡∏°‡∏µ‡∏¢";
  const services = [
    neuter,
    "‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤",
    ...(species === "‡∏™" ? ["‡∏â‡∏µ‡∏î‡∏¢‡∏≤‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ö"] : []),
    "‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏•‡∏∑‡∏≠‡∏î",
    "‡∏ù‡∏±‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡∏ä‡∏¥‡∏ü",
  ];
  container.innerHTML = "";
  services.forEach((svc, idx) => {
    const lbl = document.createElement("label");
    lbl.className = "svc-chip" + (idx === 0 ? " checked" : "");
    lbl.dataset.value = svc;
    lbl.innerHTML = `<input type="checkbox" class="svc" value="${svc}" ${idx === 0 ? "checked" : ""}>${svc}`;
    lbl.addEventListener("click", (e) => {
      e.preventDefault();
      const cb = lbl.querySelector("input");
      cb.checked = !cb.checked;
      lbl.classList.toggle("checked", cb.checked);
    });
    container.appendChild(lbl);
  });
}

/* ‚îÄ‚îÄ Add animal card ‚îÄ‚îÄ */
window.addAnimal = function () {
  animalCount++;
  const card = document.createElement("div");
  card.className = "animal-card";
  card.innerHTML = `
    <div class="animal-card-header">
      <div class="animal-card-num">${animalCount}</div>
      <span class="animal-card-label">‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${animalCount}</span>
    </div>
    <button type="button" class="btn btn-del btn-del-animal" onclick="this.closest('.animal-card').remove(); refreshCount();">üóë</button>

    <div class="animal-fields">
      <div class="field-group">
        <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå *</label>
        <input class="animalName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠..." required>
      </div>
      <div class="field-group">
        <label class="field-label">‡∏ä‡∏ô‡∏¥‡∏î</label>
        <select class="species">
          <option value="‡∏°">üê± ‡πÅ‡∏°‡∏ß</option>
          <option value="‡∏™">üê∂ ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option>
        </select>
      </div>
      <div class="field-group">
        <label class="field-label">‡πÄ‡∏û‡∏®</label>
        <select class="sex">
          <option value="‡πÄ‡∏°‡∏µ‡∏¢">‚ôÄ ‡πÄ‡∏°‡∏µ‡∏¢</option>
          <option value="‡∏ú‡∏π‡πâ">‚ôÇ ‡∏ú‡∏π‡πâ</option>
        </select>
      </div>
      <div class="field-group">
        <label class="field-label">‡∏ô‡∏ô. (‡∏Å‡∏Å.)</label>
        <input type="number" class="estWeight" value="3" min="0" step="0.1">
      </div>
    </div>

    <div class="svc-section">
      <div class="svc-label-row">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
      <div class="svc-grid"></div>
    </div>

    <div class="note-section">
      <div class="field-group">
        <label class="field-label">‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</label>
        <textarea class="healthNote" placeholder="‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß, ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á..."></textarea>
      </div>
    </div>
  `;

  const svcGrid  = card.querySelector(".svc-grid");
  const species  = card.querySelector(".species");
  const sex      = card.querySelector(".sex");
  const note     = card.querySelector(".healthNote");
  const nameInput= card.querySelector(".animalName");

  nameInput.addEventListener("input", () => { nameInput.style.borderColor = ""; });

  function refreshSvc() { buildSvcChips(svcGrid, sex.value, species.value); }
  refreshSvc();
  species.addEventListener("change", refreshSvc);
  sex.addEventListener("change", refreshSvc);
  note.addEventListener("input", () => note.classList.toggle("has-content", note.value.trim() !== ""));

  window.refreshCount = refreshCount;

  const list = document.getElementById("animalList");
  list.appendChild(card);
  refreshCount();
  card.scrollIntoView({ behavior: "smooth", block: "nearest" });
};

/* ‚îÄ‚îÄ 1. Request Consent from iPad ‚îÄ‚îÄ */
window.requestConsent = function() {
  const ownerNameInput = document.getElementById("ownerName");
  const ownerName = ownerNameInput.value.trim();
  const phone     = document.getElementById("phone").value.trim();
  const idCard    = document.getElementById("idCard").value.trim();
  const address   = document.getElementById("address").value.trim();

  // Validate
  if (!ownerName) { alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå"); ownerNameInput.focus(); return; }
  const cards = document.querySelectorAll(".animal-card");
  if (cards.length === 0) return alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");

  let hasError = false;
  let animalsData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ iPad

  cards.forEach((card, i) => {
    const ni = card.querySelector(".animalName");
    if (!ni.value.trim()) {
      alert(`‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`);
      ni.focus(); ni.style.borderColor = "var(--rose)"; hasError = true;
    } else {
      let svcs = [];
      card.querySelectorAll(".svc:checked").forEach(s => svcs.push(s.value));
      animalsData.push({
        name: ni.value.trim(),
        species: card.querySelector(".species").value === "‡∏°" ? "‡πÅ‡∏°‡∏ß" : "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç",
        sex: card.querySelector(".sex").value,
        services: svcs
      });
    }
  });

  if (hasError) return;

  // ‡πÅ‡∏û‡πá‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠ iPad
  const payloadData = {
    owner: { name: ownerName, phone: phone || "-", idCard: idCard || "-", address: address || "-" },
    animals: animalsData
  };

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°
  const btn = document.getElementById("btnRequestConsent");
  btn.disabled = true;
  btn.classList.add("waiting");
  btn.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡∏î‡∏π‡∏ó‡∏µ‡πà iPad)...";
  isWaitingForConsent = true;

  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Broadcast) ‡πÑ‡∏õ‡πÉ‡∏´‡πâ iPad
  consentChannel.send({
    type: 'broadcast',
    event: 'request-consent',
    payload: payloadData
  });
};

/* ‚îÄ‚îÄ 2. Execute Save (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ iPad ‡∏Å‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö) ‚îÄ‚îÄ */
async function executeSave() {
  isWaitingForConsent = false;
  const btnSave = document.getElementById("btnRequestConsent");
  btnSave.classList.remove("waiting");
  btnSave.textContent = "üíæ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏¥‡∏ß";

  const ownerName = document.getElementById("ownerName").value.trim();
  const phone     = document.getElementById("phone").value.trim();
  const idCard    = document.getElementById("idCard").value.trim();
  const address   = document.getElementById("address").value.trim();
  const cards = document.querySelectorAll(".animal-card");

  try {
    const { data: eventId, error: evtErr } = await supabase.rpc("get_today_event");
    if (evtErr) throw evtErr;

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å owner ‡∏û‡∏£‡πâ‡∏≠‡∏° consent_agreed = true ‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏≥‡∏ú‡πà‡∏≤‡∏ô iPad ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß)
    const { data: owner, error: ownerErr } = await supabase
      .from("vasd_owner")
      .insert({ 
        event_id: eventId, 
        owner_name: ownerName, 
        phone: phone,
        id_card: idCard,
        address: address,
        consent_agreed: true 
      })
      .select().single();
    if (ownerErr) throw ownerErr;

    const { count, error: cntErr } = await supabase
      .from("vasd_animal").select("*", { count: "exact", head: true }).eq("event_id", eventId);
    if (cntErr) throw cntErr;

    let q = (count || 0) + 1, svcs = [], queues = [], forPrint = [];

    for (const card of cards) {
      const spVal = card.querySelector(".species").value;
      const { data: animal, error: animalErr } = await supabase
        .from("vasd_animal").insert({
          event_id: eventId, owner_id: owner.id, queue_number: q++,
          species: spVal,
          animal_name: card.querySelector(".animalName").value.trim(),
          sex: card.querySelector(".sex").value,
          est_weight: card.querySelector(".estWeight").value || 0,
          health_note: card.querySelector(".healthNote").value.trim()
        }).select().single();
      if (animalErr) throw animalErr;

      let sNames = [];
      card.querySelectorAll(".svc:checked").forEach(s => {
        svcs.push({ animal_id: animal.id, service_type: s.value });
        sNames.push(s.value);
      });
      queues.push({ animal_id: animal.id, status: "waiting" });
      forPrint.push({ q: animal.queue_number, name: animal.animal_name, spc: spVal === "‡∏°" ? "‡πÅ‡∏°‡∏ß" : "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç", sex: animal.sex, svc: sNames.join(", ") });
    }

    if (svcs.length)   await supabase.from("vasd_service").insert(svcs);
    if (queues.length) await supabase.from("vasd_queue").insert(queues);

    const { data: tmplData } = await supabase.from("vasd_print_template").select("config").eq("template_type", "queue").single();
    if (tmplData?.config) {
      let html = "";
      forPrint.forEach(a => {
        let page = "<div class='sticker-page'>";
        tmplData.config.forEach(l => {
          let txt = l.text
            .replace("{{queue_number}}", a.q).replace("{{animal_name}}", a.name)
            .replace("{{species}}", a.spc).replace("{{sex}}", a.sex)
            .replace("{{owner_name}}", ownerName).replace("{{phone}}", phone || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")
            .replace("{{services}}", a.svc);
          let fnt = (l.font || "'Segoe UI'").replace(/"/g, "'");
          page += `<div class="line" style="left:${l.x||0}px;width:calc(100% - ${l.x||0}px);top:${l.y||0}px;font-size:${l.size}px;font-weight:${l.weight};font-family:${fnt};text-align:${l.align||"left"};">${txt}</div>`;
        });
        html += page + "</div>";
      });
      document.getElementById("printArea").innerHTML = html;
      try {
        await document.fonts.load("16px 'Kanit'");
        await document.fonts.load("16px 'Prompt'");
        await document.fonts.load("16px 'Sarabun'");
      } catch(e) {}
      await document.fonts.ready;
      await new Promise(r => setTimeout(r, 300));
      window.print();
    }

    setTimeout(() => { location.href = "index.html"; }, 1000);

  } catch (err) {
    console.error(err);
    alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + (err.message || "‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"));
    btnSave.disabled = false;
    btnSave.textContent = "üì≤ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ Consent ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ iPad ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
  }
}

/* auto-add first animal */
window.addAnimal();
</script>
<script type="module" src="./js/global-alarm.js"></script>
</body>
</html>
